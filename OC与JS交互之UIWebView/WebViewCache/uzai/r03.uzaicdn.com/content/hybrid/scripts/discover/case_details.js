"use strict";function onFinishRenderDirective($timeout){return{restrict:"AE",link:function(scope){scope.$first===!0,scope.$last===!0&&$timeout(function(){my_scroll(),myScroll.on("scrollEnd",function(){for(var i=0;i<$("img").length;i++)$("img").eq(i).offset().top<-myScroll.y+$("header").height()+$("#wrapper").height()&&$("img").eq(i).attr("src",$("img").eq(i).attr("data-src"));my_scroll()}),$("#wrapper").on("touchmove",function(event){return myScroll.pointY>=window.innerHeight-1?(myScroll.scrollTo(0,0,100),!1):myScroll.pointY<=40?(myScroll.scrollTo(0,myScroll.maxScrollY,100),!1):void 0});for(var i=0;i<$("img").length;i++)$("img").eq(i).offset().top<-myScroll.y+$("header").height()+$("#wrapper").height()&&$("img").eq(i).attr("src",$("img").eq(i).attr("data-src"))})}}}function my_scroll(){"undefined"==typeof myScroll?(myScroll=null,myScroll=new IScroll("#wrapper",{mouseWheel:!0,click:!0,disableMouse:!0,disablePointer:!0})):myScroll.refresh()}function androidGoBack(){bridge.goBack("",!0,!1,1)}api.__asyncLoadingCode__="0";var departureCityName=api.getQueryString("departureCityName");api.setLocalStorage("departureCityName",encodeURI(departureCityName));var myModule=angular.module("MyModule",[]),myScroll,favoriteid="0";api.isApp()?api.backUrl='javascript:bridge.goBack("", true, false, 1);':""===document.referrer&&(api.backUrl="https://m.uzai.com/discover/index.html"),myModule.controller("MyCtrl",["$scope","$http",function($scope,$http){function delay_img(){for(var elem=$("[data-src]"),i=0;i<elem.length;i++)elem.eq(i).offset().top<-myScroll.y+$("header").height()+$(".pad").height()+$("#wrapper").height()&&elem.eq(i).attr("src",elem.eq(i).attr("data-src")).removeAttr("data-src")}api.serverVirtualDir="discover",$scope.isShow=api.isApp(),$scope.departureCityName=departureCityName;var userid=api.getQueryString("disu"),subjectId=api.getQueryString("subjectid"),RequestFrom=api.getQueryString("RequestFrom"),param=JSON.stringify({RequestFrom:RequestFrom,subjectId:subjectId});api.post($http,$scope,api.path.msitelogic,"DiscoveryDetail","SubjectActivities",param,function(obj){if(200===obj.ErrorCode||-3===obj.ErrorCode){-3===obj.ErrorCode&&api.toast(obj.ErrorMsg);var subjectTitle="",subjectName="";""!==JSON.parse(obj.JsonResult).DiscoverySubjectInfo.SubjectName&&"undefined"!=typeof JSON.parse(obj.JsonResult).DiscoverySubjectInfo.SubjectName&&(subjectName=JSON.parse(obj.JsonResult).DiscoverySubjectInfo.SubjectName,subjectName.length>8&&(subjectTitle=subjectName.substr(0,8)+"..."));var subjectinfo=JSON.parse(obj.JsonResult).DiscoverySubjectInfo,maxDay="";""!==$scope.days&&"undefined"!=typeof $scope.days&&(maxDay="11天以上"!==$scope.days&&"不限"!==$scope.days?9!==$scope.days.substring(0,1)?$scope.days.substring(2,3):$scope.days.substring(3,5):"11"),$scope.title=subjectinfo.Area+maxDay+"价格 - "+subjectName+"- 众信悠哉旅游",$scope.keyword=subjectinfo.Area+maxDay+"日游价格,"+subjectinfo.Area+maxDay+"日游线路推荐,"+subjectinfo.Area+maxDay+"日游线路",$scope.description=subjectinfo.DetailsDesc.substring(0,130),$("title").html($scope.title),$('meta[name="keywords"]').attr("content",$scope.keyword),$('meta[name="description"]').attr("content",$scope.description),$scope.FilePath=JSON.parse(obj.JsonResult).DiscoverySubjectInfo.CoverImgUrl,$scope.title_m=subjectTitle,$scope.SubjectName=subjectName,$scope.pageUrl=JSON.parse(obj.JsonResult).PageUrl;var activityObj=JSON.parse(obj.JsonResult).DiscoveryActivityInfo;if($scope.values=activityObj,$("#wrapper").show(),api.isApp()&&void 0!==userid)if(userid&&"0"!==userid){var isFavoriteParam=JSON.stringify({ProductId:subjectId,SubjectId:subjectId,UserId:userid});api.post($http,$scope,api.path.msitelogic,"MyFavorite","IsSubjectFavorited",isFavoriteParam,function(favobj){200==favobj.ErrorCode||-3==favobj.ErrorCode?(-3==favobj.ErrorCode&&api.toast(favobj.ErrorMsg),favoriteid=favobj.JsonResult,"0"!==favoriteid?$(".collection").addClass("collectioned"):$(".collection").removeClass("collectioned")):api.toast(favobj.ErrorMsg)},0,!1)}else $(".collection").removeClass("collectioned");else $(".collection").removeClass("collectioned");setTimeout(delay_img,100)}else api.toast(obj.ErrorMsg)},3),$scope.addSubjectToFavorite=function(){"0"===favoriteid?bridge.addSubjectToFavorite():bridge.cancelSubjectFavorite(favoriteid)},$scope.shareSubject=function(title,content,imageUrl,pageUrl){if(content="【"+title+"】"+content,content.length+pageUrl.length>136){var allowedLength=136-pageUrl.length-6;pageUrl.length<136&&content.length>allowedLength&&(content=content.substring(0,allowedLength)+"...")}bridge.shareSubject(title,content,imageUrl,pageUrl)},$scope.callback=function(url,islastpage,isrootpage){bridge.goBack(url,islastpage,isrootpage,1)}}]),myModule.directive("onFinishRender",onFinishRenderDirective),window.addSubjectToFavoriteResponse=function(code,operate,result){"200"===code?"1"===operate?($(".collection").addClass("collectioned"),favoriteid=result,api.toast("收藏成功")):(favoriteid="0",$(".collection").removeClass("collectioned"),api.toast("取消收藏成功")):"1"===operate?api.toast("收藏失败"):api.toast("取消收藏失败")},window.androidGoBack=androidGoBack;