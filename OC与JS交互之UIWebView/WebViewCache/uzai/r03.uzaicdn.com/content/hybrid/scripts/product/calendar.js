"use strict";function androidGoBack(){window.location.href="detail.html?productid="+productid}api.serverVirtualDir="singleproduct";var skuid=api.getQueryString("skuid"),productid=api.getQueryString("productid");!function(){function sellHot(sel,price){var _sel=document.querySelector(sel);_sel.classList.add("on"),_sel.childNodes[2].innerHTML="¥"+price,_sel.childNodes[2].style.marginTop="-.25rem"}function changeMonth(){var _swiper=document.getElementsByClassName("item"),_left=document.getElementsByClassName("switch-btn")[0].getElementsByClassName("left")[0],_right=document.getElementsByClassName("switch-btn")[0].getElementsByClassName("right")[0],_myCur=document.querySelector(".swiper-slide-active"),_li=_myCur.getElementsByTagName("li");if(_li[0].classList.contains("new")){var _new=_myCur.querySelectorAll(".new"),_curDay=_new[_new.length-1].nextSibling.getAttribute("data-time"),_ary=_curDay.split("-"),_month=document.getElementsByClassName("switch-btn")[0].getElementsByClassName("center")[0].getElementsByClassName("month")[0],_year=_month.nextElementSibling;document.getElementsByClassName("center")[0].style.display="block",_month.innerHTML=_ary[1],_year.lastElementChild.innerHTML=_ary[0]}else{var _curDay2=_li[0].getAttribute("data-time"),_ary2=_curDay2.split("-"),_month2=document.getElementsByClassName("switch-btn")[0].getElementsByClassName("center")[0].getElementsByClassName("month")[0],_year2=_month2.nextElementSibling;document.getElementsByClassName("center")[0].style.display="block",_month2.innerHTML=_ary2[1],_year2.lastElementChild.innerHTML=_ary2[0]}var _prevSibling=_myCur.previousElementSibling;if(_swiper[0].classList.contains("swiper-slide-active"))_left.innerHTML="";else if(_prevSibling)if(_prevSibling.childNodes[0].childNodes[0].classList.contains("new")){var _new2=_prevSibling.querySelectorAll(".new"),_lastDay=_new2[_new2.length-1].nextSibling.getAttribute("data-time"),_lastAry=_lastDay.split("-");_left.innerHTML=_lastAry[1]+"月"}else{var _lastDay2=_prevSibling.childNodes[0].childNodes[0].getAttribute("data-time"),_lastAry2=_lastDay2.split("-");_left.innerHTML=_lastAry2[1]+"月"}var _nextSibling=_myCur.nextElementSibling;if(_swiper[_swiper.length-1].classList.contains("swiper-slide-active"))_right.innerHTML="";else if(_nextSibling)if(_nextSibling.childNodes[0].childNodes[0].classList.contains("new")){var _new3=_nextSibling.querySelectorAll(".new"),_newDay=_new3[_new3.length-1].nextSibling.getAttribute("data-time"),_newAry=_newDay.split("-");_right.innerHTML=_newAry[1]+"月"}else{var _newDay2=_nextSibling.childNodes[0].childNodes[0].getAttribute("data-time"),_newAry2=_newDay2.split("-");_right.innerHTML=_newAry2[1]+"月"}}function disablebuy(){var _noDate=document.getElementsByClassName("no-tuan")[0];_noDate.style.display="block";var _yuding=document.getElementsByClassName("buy-now")[0];_yuding.innerHTML="无 团 期",_yuding.classList.add("no-click"),_yuding.style.cssText="background:#ddd",_yuding.classList.remove("buy-now");var _noClick=document.getElementsByClassName("no-click");_noClick.onclick=function(){return!1}}function clickNow(calendarData){for(var _on=document.getElementsByClassName("on"),_dateText=document.getElementsByClassName("date-xz")[0],i=0,len=_on.length;len>i;i++)_on[i].index=i,_on[i].onclick=function(){document.getElementsByClassName("buy-no")[0].style.display="none",document.getElementsByClassName("buy-now")[0].style.display="inline-block";for(var j=0;j<_on.length;j++)_on[j].classList.remove("cur");_on[this.index].classList.add("cur");var selectedDate=_on[this.index].dataset.time;angular.forEach(calendarData,function(data){return data.TourDateText===selectedDate?(_dateText.innerHTML='日期：<em class="date-text">'+data.TourDateText+"</em>",void(para=productid+"_"+skuid+"_"+data.TourDateText)):void 0})}}function buynow(){var $buyNow=document.getElementsByClassName("buy-now")[0];$buyNow.onclick=function(){}}var calendar=function(time,obj){function getDayNum(year,month){var _veader=!(year%400)||!(year%4)&&year%100,_num=void 0;switch(month){case 2:_num=_veader?29:28;break;case 1:case 3:case 7:case 5:case 8:case 10:case 12:_num=31;break;default:_num=30}return _num}obj=obj||"body";var _NewDate=new Date(time.split("-")[0],time.split("-")[1]-1)||new Date,_nYear=_NewDate.getFullYear(),_nMonth=_NewDate.getMonth()+1,_curMonthDate=getDayNum(_nYear,_nMonth),_calendarBox=document.createElement("div");_calendarBox.setAttribute("class","calendar-box zShow swiper-slide item");var _weekList=document.getElementsByClassName("week-list")[0],_str="<li>日</li><li>一</li><li>二</li><li>三</li><li>四</li><li>五</li><li>六</li>";_weekList.innerHTML=_str;var _dayLi="",_dayList=document.createElement("ul");_dayList.setAttribute("class","day-list");for(var _newDate=new Date(_nYear,_nMonth-1,1),_curMonthWeek=_newDate.getDay(),i=1;42>=i;i++)_dayLi+=_curMonthWeek>=i?'<li class="new"></li>':i>=_curMonthWeek&&_curMonthDate+_curMonthWeek>=i?"<li data-time="+_nYear+"-"+addZero(_nMonth)+"-"+addZero(i-_curMonthWeek)+'><p class="text">'+(i-_curMonthWeek)+'</p><p class="end"></p><p class="price"></p><p class="dingwei"><i class="chinas zHide">●</i><i class="locals zHide">●</i></p><p class="jieqi"></p></li>':'<li class="old"></li>';_dayList.innerHTML=_dayLi,_calendarBox.appendChild(_dayList);var _boxCenter=document.getElementsByClassName("box-center")[0];_boxCenter.appendChild(_calendarBox)},addZero=function(num){return 9>=num?"0"+num:""+num},app=angular.module("calendarapp",[]),para="";app.controller("calendardetail",function($scope,$http){var param=JSON.stringify({SkuID:skuid,ProductID:productid}),productname="",dd=new Date;dd.setDate(dd.getDate());var todayOfYear=dd.getFullYear(),todayOfMonth=dd.getMonth(),todayOfDay=dd.getDate(),calendarData=void 0;api.post($http,$scope,"http://msingleproductlogic.uzai.com/api/","UzaiTourDate","GetSkuTourDate",param,function(obj){if(200!==obj.ErrorCode)disablebuy();else if(200===obj.ErrorCode||-3===obj.ErrorCode){if(-3===obj.ErrorCode)return api.toast(obj.ErrorMsg),void($scope.backshow=!0);if("undefined"!=typeof obj.JsonResult&&null!==obj.JsonResult){calendarData=JSON.parse(obj.JsonResult),null!==calendarData.ProductName&&(productname=calendarData.ProductName,document.getElementsByTagName("title")[0].text=productname+"日期选择-众信旅游悠哉网",document.getElementsByName("keywords")[0].setAttribute("content",productname+"日期选择"),document.getElementsByName("description")[0].setAttribute("content",productname+"日期选择-众信旅游悠哉网")),null!==calendarData.TodayOfYear&&"undefined"!==calendarData.TodayOfYear&&(todayOfYear=calendarData.TodayOfYear),null!==calendarData.TodayOfMonth&&"undefined"!==calendarData.TodayOfMonth&&(todayOfMonth=calendarData.TodayOfMonth),null!==calendarData.TodayOfDay&&"undefined"!==calendarData.TodayOfDay&&(todayOfDay=calendarData.TodayOfDay),"undefined"!=typeof calendarData.CalendarTitle&&null!==calendarData.CalendarTitle&&angular.forEach(calendarData.CalendarTitle,function(data){calendar(data,".box-center")});var CreateCalendar={create:function(){var CreateCalendar={init:function(){this.changeTitle(),this.addWeekColor(),this.getDateCur()},addWeekColor:function(){var _weekList=document.getElementsByClassName("week-list")[0],_li=_weekList.getElementsByTagName("li"),_len=_li.length;_li[0].style.color="red",_li[_len-1].style.color="red"},getDateCur:function(){for(var GetDateStr=function(){return todayOfYear+"-"+todayOfMonth+"-"+todayOfDay},_ul=document.getElementsByClassName("day-list"),i=0;i<_ul.length;i++)for(var _li=_ul[i].childNodes,j=0;j<_li.length;j++){_li[j].setAttribute("data-index",j);var _date=_li[j].getAttribute("data-time");_date===GetDateStr(0)&&(_li[j].className.match(new RegExp("(\\s|^)now(\\s|$)"))||(_li[j].className+=" now"),_li[j].className.match(new RegExp("(\\s|^)off(\\s|$)"))&&(_li[j].className=_li[j].className.replace(new RegExp("(\\s|^)off(\\s|$)"),"")))}if(document.getElementsByClassName("now")[0]){for(var _nowset=Date.parse(new Date(document.getElementsByClassName("now")[0].dataset.time))/1e3,_i=0;_i<_ul.length;_i++)for(var _li2=_ul[_i].childNodes,_j=0;_j<_li2.length;_j++){var _dateset=Date.parse(new Date(_li2[_j].dataset.time))/1e3;_li2[_j].dataset.time&&_nowset>_dateset&&(_li2[_j].classList.add("off"),_li2[_j].classList.add("over"),_li2[_j].onclick=function(){return!1})}var _now=document.getElementsByClassName("now")[0];_now.childNodes[0].innerHTML="今天",_now.nextElementSibling.childNodes[0].innerHTML="明天",_now.nextElementSibling.nextElementSibling.childNodes[0].innerHTML="后天"}},changeTitle:function(){var _switchBtn=document.getElementsByClassName("switch-btn")[0],_left=_switchBtn.getElementsByClassName("left")[0],_right=_switchBtn.getElementsByClassName("right")[0];_left.onclick=function(){_mySwiper.slidePrev(),setTimeout(function(){changeMonth()},500)},_right.onclick=function(){_mySwiper.slideNext(),setTimeout(function(){changeMonth()},500)}}};return CreateCalendar}},myCalendar=CreateCalendar.create();myCalendar.init();var _mySwiper=new Swiper(".swiper-container",{pagination:".pagination",loop:!1,mode:"horizontal",freeMode:!1,touchRatio:.5,longSwipesRatio:.1,watchActiveIndex:!0,threshold:50,followFinger:!1,observer:!0,observeParents:!0,onSlideChangeEnd:function(){changeMonth()}}),_sliderWidth=document.getElementsByClassName("calendar-box"),_sliderW=_sliderWidth[0].style.width,_sliderParent=document.getElementsByClassName("box-center")[0];_sliderParent.style.width=_sliderW.replace("px","")*_sliderWidth.length+"px",changeMonth(),angular.forEach(calendarData.CalendarData,function(data){var dateprice='[data-time="'+data.TourDateText+'"]';sellHot(dateprice,data.MinPrice)}),clickNow(calendarData.CalendarData),buynow()}}else $scope.backshow=!0,api.endloading(),api.toast(obj.ErrorMsg);document.getElementById("uzai-calendar-header").style.cssText="display:block",document.getElementById("uzai-calendar-container").style.cssText="display:block",document.getElementById("uzai-calendar-footer").style.cssText="display:block"},3,!1),$scope.backpage=function(){window.location.href="detail.html?productid="+productid},$scope.next=function(){var url="https://mbuy.uzai.com/booking/individual-index.html?para="+para;""!==api.getUser().userId&&null!==api.getUser().userId&&"undefined"!=typeof api.getUser().userId?window.location.href=url:api.login(location.href,url)}});var mySwiper=new Swiper(".swiper-container",{pagination:".pagination",loop:!1,mode:"horizontal",freeMode:!1,touchRatio:.5,longSwipesRatio:.1,watchActiveIndex:!0,threshold:50,followFinger:!1,observer:!0,observeParents:!0,onSlideChangeEnd:function(){changeMonth()}}),_switchBtn=document.getElementsByClassName("switch-btn")[0],_left=_switchBtn.getElementsByClassName("left")[0],_right=_switchBtn.getElementsByClassName("right")[0];_left.onclick=function(){mySwiper.slidePrev(),setTimeout(function(){changeMonth()},500)},_right.onclick=function(){mySwiper.slideNext(),setTimeout(function(){changeMonth()},500)}}(window),window.androidGoBack=window.androidGoBack||androidGoBack;