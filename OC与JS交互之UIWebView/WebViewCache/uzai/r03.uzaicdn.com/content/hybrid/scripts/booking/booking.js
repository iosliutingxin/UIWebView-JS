"use strict";function PreferentialList(preList,$scope){if(null!==preList&&preList.length>0){for(var isBank=!1,i=0;i<preList.length;i++)1===preList[i].PreferentialType&&($scope.BanKPreferential=preList[i],$scope.BanKPreferential.Checked&&(isBank=!0),$scope.BanKPreferential.Activities.length>0&&($scope.DefautBanKPreferential=$scope.BanKPreferential.Activities[0])),2===preList[i].PreferentialType&&($scope.StandardPreferential=preList[i],$scope.StandardPreferential.Checked&&($("#simple").attr("checked","checked"),$scope.IsStandard=!0,isBank=!1,$scope.DetailPreferential=$scope.StandardPreferential.Activities));for(var _i3=0;_i3<$scope.StandardPreferential.Activities.length;_i3++)2===$scope.StandardPreferential.Activities[_i3].ParentTypeId&&($scope.SubTypeName=$scope.StandardPreferential.Activities[_i3].SubTypeName);$scope.MaxBankPreferential=isBank,isBank?($("#simple").removeAttr("checked"),setTimeout(function(){$(".standard_discount").eq(0).addClass("red_hover").siblings().removeClass("red_hover"),$("#bank_list_url").show()},100),$scope.IsStandard=!1,$scope.DetailPreferential=$scope.DefautBanKPreferential):($scope.IsStandard=!0,$scope.DetailPreferential=$scope.StandardPreferential.Activities,setTimeout(function(){$("#simple").attr("checked","checked"),$(".standard_discount").eq(1).addClass("red_hover").siblings().removeClass("red_hover"),$("#bank_list_url").hide()},100)),$scope.PreferentialSolution=preList}CaluateTotalPrice($scope)}function EditTreaveler(id,paperKeyId){if(id>0){var param1=JSON.stringify({id:id,UzaiTravelClassId:uzaiTravelClassId,PaperKeyId:paperKeyId});api.post(httpObj,scopeObj,api.path.mbuylogic,"UserContacter","TravellerEdit",param1,function(obj){if($("#toast-pop").remove(),200===obj.ErrorCode){editpapertypeselect="";var result=JSON.parse(obj.JsonResult);$(".name").val(result.TravellerName),$(".edit-people ul li").eq(1).find(".active").removeClass("active"),0===result.Gender?$(".nv").addClass("active"):$(".nan").addClass("active"),$(".date").val(result.BirthDate).attr("value",result.BirthDate).next().hide(),$(".phone").val(result.Mobile),$(".nationality").val(result.Nationality),1!==$isTravellerPaperLater?($(".numberId").val("0"===result.PaperNumber?"":result.PaperNumber),$(".city").val(result.SignUpPlace),$("#paperKeyId").val(paperKeyId)):($("#paperinfo").addClass("hide"),$("#paperplaceinfo").addClass("hide"),$("#paperdateinfo").addClass("hide")),""===result.PaperValidateDate?($(".edit-people ul li .lineTime").next().css("display","inline-block"),$(".edit-people ul li .lineTime").css("color","#fff")):($(".edit-people ul li .lineTime").next().css("display","none"),$(".edit-people ul li .lineTime").css("color","#666")),$(".lineTime").val(result.PaperValidateDate).attr("value",result.PaperValidateDate).next().hide(),1===$isTravellerPaperLater||0===paperKeyId?scopeObj.editpeopleselect="-10_-10":(-1===paperKeyId?2===uzaiTravelClassId||3===uzaiTravelClassId?scopeObj.editpeopleselect="0_4":scopeObj.editpeopleselect="4_0":scopeObj.editpeopleselect=result.PaperTypeCode,$("#paperinfo").removeClass("hide"),$("#paperplaceinfo").removeClass("hide"),$("#paperdateinfo").removeClass("hide"),$(".numberId").val("0"===result.PaperNumber?"":result.PaperNumber),$(".city").val(result.SignUpPlace),$("#paperKeyId").val(paperKeyId),""===result.PaperValidateDate?($(".edit-people ul li .lineTime").next().css("display","inline-block"),$(".edit-people ul li .lineTime").css("color","#fff")):($(".edit-people ul li .lineTime").next().css("display","none"),$(".edit-people ul li .lineTime").css("color","#666")),$(".lineTime").val(result.PaperValidateDate).attr("value",result.PaperValidateDate).next().hide())}else api.toast(obj.ErrorMsg);api.endloading()},0,!1)}}function androidGoBack(){var htmlname=location.href.split("#")[1],hash=window.location.hash;if("/"===htmlname||void 0===htmlname||""===htmlname)$("#payment-common-pop1").fadeIn(),$(".cal-mask").show();else if(hash.indexOf("editpeople")>-1)window.location.hash="#/travepeople";else if(hash.indexOf("selectcoupons")>-1){var $mask=$(".cal-mask1"),$pop=$("#cal-pop");$mask.fadeOut(),$pop.hide(),api.routerGoBack()}else if(hash.indexOf("index")>-1){var _$mask=$(".cal-mask"),$paymentPop=$("#payment-common-pop1");_$mask.show(),$paymentPop.fadeIn()}else api.routerGoBack();$(".uzai-wrapper").show()}function validate(obj,type){if(1===type&&($(obj).length>8?$(obj).css("color","#f00"):$(obj).css("color","#666666")),2===type){var reP=new RegExp(/^1[3|4|5|7|8]\d{9}$/);reP.test($(obj).val())?$(obj).css("color","#666666"):($(obj).css("color","#f00"),$(obj).val().length>10&&($(obj).val($(obj).val().slice(0,11)),$(obj).css("color","#666666")))}if(3===type){var _reP=new RegExp(/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/);_reP.test($(obj).val())?$(obj).css("color","#666666"):$(obj).css("color","#f00")}if(4===type){var _reP2=new RegExp(/^[a-zA-Z\u4e00-\u9fa5]+$/);""==$(obj).val()||_reP2.test($(obj).val())||setTimeout(function(){$(obj).val($(obj).val().slice(0,$(obj).val().length-1))},50)}}function popup(text){void 0===text&&(text=""),$(".popup").show(),$(".popup span").html(text),setTimeout(function(){$(".popup").fadeOut()},2e3)}function namereg(name){var regpeopleName=/[\u4e00-\u9fa5_a-zA-Z_]{2,20}/;return regpeopleName.test(name)}function PaperidReg(papertype,id){var paperIDreg=new RegExp(/^[A-Za-z0-9]+$/);if(void 0!==papertype&&null!==papertype&&"-99_-99"!==papertype){var _choosePtype=papertype.split(":")[1];"4_0"===_choosePtype||"8_1"===_choosePtype||"9_6"===_choosePtype?paperIDreg=new RegExp(/^([A-Za-z0-9]){5,15}$/):"0_4"===_choosePtype?paperIDreg=new RegExp(/^[1-9]\d{5}[1-9]\d{3}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])\d{3}([0-9]|X)$/):"6_3"===_choosePtype?paperIDreg=new RegExp(/^([A-Za-z0-9\(\)]){1,50}$/):"7_2"===_choosePtype?paperIDreg=new RegExp(/^([A-Za-z0-9]){1,50}$/):"2_8"===_choosePtype?paperIDreg=new RegExp(/^[\u4e00-\u9fa5a-zA-Z\d]{1,50}$/):"-1_5"===_choosePtype&&(paperIDreg=new RegExp(/^.{1,50}$/))}return paperIDreg.test(id)}function PaperAddressReg(addr){var regpaperAddress=/^[A-Za-z\u4e00-\u9fa5]+$/;return regpaperAddress.test(addr)}function noMouseWheel(){$(document).on("mousewheel DOMMouseScroll",function(e){var delta=e.originalEvent.wheelDelta&&(e.originalEvent.wheelDelta>0?1:-1)||e.originalEvent.detail&&(e.originalEvent.detail>0?-1:1);return delta>0?!1:0>delta?!1:void 0})}api.__asyncLoadingCode__="0";var deviceType=api.getQueryString("devicetype"),appversion=api.getQueryString("appversion"),httpObj=null,$isNeedTraveller=1,$isTravellerPaperLater=0,scopeObj=null,editedPaperInfo="",couponsPrice=0,editpapertypeselect="4_0",editpeopleId=[],uzaiTravelClassId=1,uzai=angular.module("booking",[]);window.goDate="",window.adultCount=0,window.childCount=0;var pId="";window.jouneryGroupId=0;var $vstoreid=0;"undefined"!=typeof api.getQueryString("vstoreid")&&null!==api.getQueryString("vstoreid")&&($vstoreid=api.getQueryString("vstoreid"));var _BoardingLocationStr="",_OrderID=0,_OrderType=0,para=api.getQueryString("para");if(null!==para&&""!==para){var arrayAttr=para.split("_");pId=parseInt(arrayAttr[0]),adultCount=parseInt(arrayAttr[1]),childCount=parseInt(arrayAttr[2]),goDate=arrayAttr[3],jouneryGroupId=parseInt(arrayAttr[4])}var url="https://m.uzai.com/product/calendar.html?productid="+pId;api.loginConfig.forword=location.href,api.loginConfig.from=url;var Booking_subPage={create:function(){function CreateTrave(sel,options){this.sel=sel,this.options=options}var Booking_subPage={};return Booking_subPage.historyClick=function(){},CreateTrave.prototype={constructor:CreateTrave,init:function(){this.changeSex(),this.selectCoupons(),this.selectStore()},changeSex:function(){},selectStore:function(){$(".uzai-store li").click(function(){var $this=$(this);$this.addClass("active").siblings().removeClass("active")})},selectCoupons:function(){$(".choose-coupons").click(function(){var $this=$(this);$this.hasClass("activing")?$this.toggleClass("activing"):$this.addClass("activing").siblings(".choose-coupons").removeClass("activing")})}},Booking_subPage.myTrave=new CreateTrave,Booking_subPage.myTrave.init(),Booking_subPage}};window.BookingSub=Booking_subPage.create(),function(window,document,$,uzai,BookingSub){uzai.controller("bookContent",function($http,$scope,$compile,$filter,$timeout){angular.element(document).ready(function(){api.router($http,$scope,$compile,"0")}),httpObj=$http,scopeObj=$scope,$scope.trave_people_init=function(isRefesh){if(null===$scope.contacters||void 0===$scope.contacters||isRefesh){var param=JSON.stringify({userid:api.getUser().userId,UzaiTravelClassId:uzaiTravelClassId,paperType:editedPaperInfo});api.post($http,$scope,api.path.mbuylogic,"UserContacter","TravellerList",param,function(obj){if($("#toast-pop").remove(),200===obj.ErrorCode||-3===obj.ErrorCode){if(-3===obj.ErrorCode)return api.endloading(),api.toast("网络连接失败,请重试～"),$("#loading").addClass("endloading-opacity-0").removeClass("endloading-opacity-1"),!1;var result=JSON.parse(obj.JsonResult);$scope.contacters=result}else api.endloading(),api.toast(obj.ErrorMsg);if(void 0===$scope.contacters||0===$scope.contacters.length){var html='<div class="no-traver"><div class="bg"></div><p>暂无出游人，快去添加吧</p></div>';return 0===$(".no-traver").length?$("#J_router_travepeople").append(html):""}$(".no-traver").hide(),api.endloading()},0,!1)}else if(void 0===$scope.contacters||null===$scope.contacters||0===$scope.contacters.length){var html='<div class="no-traver"><div class="bg"></div><p>暂无出游人，快去添加吧</p></div>';0===$(".no-traver").length?$("#J_router_travepeople").append(html):""}else{$(".no-traver").hide();var isChooseTravelPeople=!1;isChooseTravelPeople||$(".trave-people").find("li").each(function(){$(this).find(".choosing").removeClass("choose-yes")}),$("#choseTravelList .travel_list").each(function(){isChooseTravelPeople=!0;var travelPeopleId=$(this).find("#travelId").val();$(".trave-people").find("li").each(function(){$(this).find(".name").attr("paperid")===travelPeopleId&&$(this).find(".choosing").addClass("choose-yes")})})}},$scope.chuxingrensave=function(){var choosenum=$(".choose-yes").next().length;if($scope.traveNum=choosenum,(choosenum<$scope.TotalPerson||choosenum>$scope.TotalPerson)&&1===$isNeedTraveller)return void api.toast("请选择"+$scope.TotalPerson+"位出游人！");var chuxingrenhtml="";if($(".choose-yes").next().each(function(index,obj){var id=$(this).find(".name").attr("paperid"),paperkeyid=$(this).find(".name").attr("paperkeyid"),name=$(this).find(".name").text(),passport=$(this).find(".passport").find("em").text();0===parseInt(paperkeyid)&&(passport="稍后提供");var html="";html=2>=index?"<div class='travel_list'><span class='name'>"+name+"</span><span class='passport'>"+passport+"</span><input type='hidden' id='travelId' value='"+id+"'></input><input type='hidden' id='paperkeyid' value='"+paperkeyid+"'></input></div>":"<div class='travel_list' style='display:none'><span class='name'>"+name+"</span><span class='passport'>"+passport+"</span><input type='hidden' id='travelId' value='"+id+"'></input><input type='hidden' id='paperkeyid' value='"+paperkeyid+"'></input></div>",chuxingrenhtml+=html}),$("#choseTravelList").html(""),$("#choseTravelList").html(chuxingrenhtml),""===$("#choseTravelList").html())$("#choseTravelList").parent().hide();else{var travelPersonCount=$("#choseTravelList").find(".travel_list").length;travelPersonCount>3?$("#choseTravelList").parent().find(".main4_m1_more").show():$("#choseTravelList").parent().find(".main4_m1_more").hide(),$("#choseTravelList").parent().show()}$("#xuanzechuyourenflag").hide(),api.routerGoBack()},$scope.GoBackProductDetail=function(){$("#payment-common-pop1").fadeIn(),$(".cal-mask").eq(0).removeClass("hide").show()},$scope.toeditpeople=function(id,paperKeyId){$isTravellerPaperLater=0,$(".phone-tips").hide(),$(".paper-tips").hide(),$("#title").html("编辑出游人信息"),""!==api.getCookie("travelId")?$("#editContacterId").val(id):$("#editContacterId").val(""),$(".trave-people .choose-yes").each(function(){editpeopleId.push($(this).next().find(".name").attr("paperid"))}),api.setCookie("travelId",id),$scope.LoadPaperType(),console.log("234LoadPaperType"),null!==scopeObj.TreavlePeopleId&&void 0!==scopeObj.TreavlePeopleId&&0!==scopeObj.TreavlePeopleId?EditTreaveler(id,paperKeyId):void 0!==$("#J_router_editpeople")?EditTreaveler(id,paperKeyId):scopeObj.TreavlePeopleId=id},$scope.addtravePeople=function(){$("#editContacterId").val(""),$(".date").val("").attr("value","").next().hide(),$("#title").html("添加出游人信息"),$(".nationality").val("中国大陆"),$(".name").val(""),$(".edit-people ul li").eq(1).find(".active").removeClass("active"),$(".phone").val(""),$(".numberId").val(""),$(".city").val(""),$(".lineTime").val(""),api.setCookie("travelId",""),$(".lineTime").val("").attr("value","").next().hide(),$(".edit-people ul li .lineTime").next().css("display","inline-block"),$(".edit-people ul li .lineTime").css("color","#fff"),$(".date").val("").attr("value","").next().hide(),$(".edit-people ul li .lineTime").next().css("display","inline-block"),$(".edit-people ul li .lineTime").css("color","#fff"),$(".lineTime").val("").attr("value","").next().hide(),$("#paperinfo").addClass("hide"),$("#paperplaceinfo").addClass("hide"),$("#paperdateinfo").addClass("hide"),$("#paperKeyId").val("-10"),scopeObj.editpeopleselect="-10_-10",$isTravellerPaperLater=1},$scope.LoadPaperType=function(){if(console.log("LoadPaperType--里"),1===uzaiTravelClassId||15===uzaiTravelClassId){var paperType='[{"Name":"护照","Val":"4_0"},{"Name":"港澳通行证","Val":"8_1"},{"Name":"台湾通行证","Val":"9_6"},{"Name":"稍后提供","Val":"-10_-10"}]';$scope.papers=JSON.parse(paperType)}else{var _paperType='[{"Name":"身份证","Val":"0_4"},{"Name":"台胞证","Val":"6_3"},{"Name":"回乡证","Val":"7_2"},{"Name":"军官证","Val":"2_8"},{"Name":"其他","Val":"-1_5"},{"Name":"稍后提供","Val":"-10_-10"}]';$scope.papers=JSON.parse(_paperType)}api.endloading()},$scope.tarveBack=function(){null!==$(".no-trave")&&void 0!==$(".no-trave")&&$(".no-traver").remove()},$scope.deleteBg=function(){null!==$(".no-coupons-now")&&void 0!==$(".no-coupons-now")&&$(".no-coupons-now").remove()},$scope.typeChange=function(changedPaperType){if("-10_-10"===changedPaperType)return $("#paperKeyId").val(""),$(".numberId").val(""),$(".city").val(""),$(".lineTime").val("").attr("value","").next().hide(),$(".edit-people ul li .lineTime").next().css("display","inline-block"),$(".edit-people ul li .lineTime").css("color","#fff"),$("#paperinfo").addClass("hide"),$("#paperplaceinfo").addClass("hide"),$("#paperdateinfo").addClass("hide"),$isTravellerPaperLater=1,scopeObj.editpeopleselect="-10_-10",void $("#paperKeyId").val("-10");$("#paperinfo").removeClass("hide"),$("#paperplaceinfo").removeClass("hide"),$("#paperdateinfo").removeClass("hide"),$isTravellerPaperLater=0;var param=JSON.stringify({UserID:api.getUser().userId,paperType:changedPaperType,ContacterId:$("#editContacterId").val()});api.post($http,$scope,api.path.mbuylogic,"UserContacter","UserPaperInfo",param,function(obj){if($("#toast-pop").remove(),200===obj.ErrorCode)if("null"===obj.JsonResult)$("#paperKeyId").val(""),$(".numberId").val(""),$(".city").val(""),$(".lineTime").val("").attr("value","").next().hide(),$(".edit-people ul li .lineTime").next().css("display","inline-block"),$(".edit-people ul li .lineTime").css("color","#fff");else{var result=JSON.parse(obj.JsonResult);$("#paperKeyId").val(result.ID),$(".numberId").val(result.PaperID),$(".city").val(result.PaperSignAddress);var paperEffectTime="1900-01-01T00:00:00"===result.PaperEffectiveTime?"":result.PaperEffectiveTime.substring(0,10);$(".lineTime").val(paperEffectTime).attr("value",paperEffectTime).next().hide(),""===paperEffectTime?($(".edit-people ul li .lineTime").next().css("display","inline-block"),$(".edit-people ul li .lineTime").css("color","#fff")):($(".edit-people ul li .lineTime").next().css("display","none"),$(".edit-people ul li .lineTime").css("color","#666"))}else api.toast(obj.ErrorMsg);api.endloading()},0,!1)},$scope.insertPeople=function(id){var username=$("li>.name").val(),sex=$(".edit-people ul li").eq(1).find(".active").html();if("男"===sex)sex=1;else{if("女"!==sex)return void api.toast("请选择性别");sex=0}var borthdate=$(".date").val(),phone=$(".phone").val(),nation=$(".nationality").val(),UserContacterID=api.getCookie("travelId"),PaperID=$(".numberId").val(),city=$(".city").val(),lineTime=$(".lineTime").val(),papersid=$("#paperid").val(),papertype=$("#passportofpaper").val();if(""===username&&0===username.length)return void $(".edit-people .name-tips").show();if(!namereg(username))return void $(".edit-people .name-tips").show();if($(".edit-people .name-tips").hide(),""===borthdate&&0===borthdate.length)return void api.toast("请选择出生日期");var rePs=new RegExp(/^1[3|4|5|7|8]\d{9}$/),pVal=$(".edit-people ul li .phone").val();if(""!==pVal){if(!rePs.test(pVal))return void $(".edit-people .phone-tips").show();$(".edit-people .phone-tips").hide()}if(""!==nation&&null!==nation){if(!PaperAddressReg(nation))return void $(".edit-people .nation").show();$(".edit-people .nation").hide()}if(""!==PaperID&&void 0!==PaperID&&!PaperidReg(papertype,PaperID))return void $(".edit-people .paperid").show();if(""!==city&&void 0!==city){if(!PaperAddressReg(city))return void $(".edit-people .paperaddr").show();$(".edit-people .paperaddr").hide()}var guonei=void 0,guowai=void 0;void 0!==papertype&&null!==papertype&&"-99_-99"!==papertype&&("string"===papertype.split(":")[0]?(papertype=papertype.split(":")[1],guonei=papertype.split("_")[0],guowai=papertype.split("_")[1]):(guonei=papertype.split("_")[0],guowai=papertype.split("_")[1]));var param=JSON.stringify({UserID:api.getUser().userId,CnName:username,Sex:sex,BirthTime:borthdate,Phone:phone,Nationality:nation,ID:UserContacterID,PaperID:PaperID,PaperSignAddress:city,PaperEffectiveTime:lineTime,PapersId:papersid,DeparturesPaperType:guowai,DomesticPaperType:guonei});""!==api.getCookie("travelId")?api.post($http,$scope,api.path.mbuylogic,"UserContacter","UpdateContacter",param,function(obj){return $("#toast-pop").remove(),200!==obj.ErrorCode?void api.toast(obj.ErrorMsg):(1===$isTravellerPaperLater&&(PaperID="-10"),"0"!==$("#paperKeyId").val()&&""!==$("#paperKeyId").val()?editedPaperInfo=1===$isTravellerPaperLater?api.getCookie("travelId")+"_-10|"+editedPaperInfo:api.getCookie("travelId")+"_"+$("#paperKeyId").val()+"|"+editedPaperInfo:"0"!==$("#paperKeyId").val()&&""!==$("#paperKeyId").val()||(editedPaperInfo=api.getCookie("travelId")+"_"+JSON.parse(obj.JsonResult)+"|"+editedPaperInfo),$scope.trave_people_init(!0),location.href="#/travepeople",api.endloading(),void($isTravellerPaperLater=0))},0,!1):api.post($http,$scope,api.path.mbuylogic,"UserContacter","AddContacter",param,function(obj){$("#toast-pop").remove(),200===obj.ErrorCode?("0"!==$("#paperKeyId").val()&&""!==$("#paperKeyId").val()&&(editedPaperInfo=api.getCookie("travelId")+"_"+$("#paperKeyId").val()+"|"+editedPaperInfo),$scope.trave_people_init(!0),location.href="#/travepeople"):api.toast(obj.ErrorMsg),api.endloading(),$isTravellerPaperLater=0},0,!1)},$scope.hideTips=function(){$(".myTips").hide()},$scope.destory1=function(){},$scope.changeStore=function(){if(null===$scope.Citys||void 0===$scope.Citys){var param=JSON.stringify({userid:api.getUser().userId});api.post($http,$scope,api.path.mbuylogic,"SupplierStore","GetSupplierStore",param,function(obj){if(200===obj.ErrorCode){var result=JSON.parse(obj.JsonResult);$scope.Citys=result.listCity,$scope.StoreMapDomain=result.StoreMapDomain,result.listCity.length>0&&($scope.Areas=result.listCity[0].listArea,result.listCity[0].listArea.length>0&&($scope.Stores=$scope.Areas[0].listStore)),void 0!==$scope.selected&&""!==$scope.selected||($scope.selected=$scope.Citys[0].UzaiCity),void 0!==$scope.areaSelected&&""!==$scope.areaSelected||($scope.areaSelected=$scope.Areas[0].AreaName),$scope.LoadArea(),$scope.LoadStore()}else api.toast(obj.ErrorMsg)},0,!1)}},$scope.LoadArea=function(ty){for(var cityId=$scope.selected,cityArr=$scope.Citys,i=0;i<cityArr.length;i++)cityId===cityArr[i].UzaiCity&&($scope.Areas=cityArr[i].listArea,1===ty&&($scope.areaSelected=$scope.Areas[0].AreaName));for(var _i=0;_i<$scope.Areas.length;_i++)$scope.Areas[0].AreaName===$scope.Areas[_i].AreaName&&($scope.Stores=$scope.Areas[_i].listStore)},$scope.LoadStore=function(){for(var areaName=$scope.areaSelected,areaArr=$scope.Areas,i=0;i<areaArr.length;i++)areaName===areaArr[i].AreaName&&($scope.Stores=areaArr[i].listStore)},$scope.couponsinit=function(isrefresh){if($(".coupons-search input").val(""),null===$scope.TourTotalPrice||void 0===$scope.TourTotalPrice||""===$scope.TourTotalPrice||0===$scope.TourTotalPrice?$scope.TourTotalPrice=api.getLocalStorage("TourTotalPrice"):api.setLocalStorage("TourTotalPrice",$scope.TourTotalPrice),null===$scope.StartCityID||void 0===$scope.StartCityID||""===$scope.StartCityID||0===$scope.StartCityID?$scope.StartCityID=api.getLocalStorage("StartCityID"):api.setLocalStorage("StartCityID",$scope.StartCityID),null===$scope.keyonglist||void 0===$scope.keyonglist||null===$scope.bukeyonglist||void 0===$scope.bukeyonglist||isrefresh){var param=JSON.stringify({userId:api.getUser().userId,productId:pId,prepayMent:$scope.TourTotalPrice,cityId:$scope.StartCityID,sumPerson:$scope.TotalPerson,platfrom:api.isApp()?"APP客户端":"触屏版"});window.keyongbool=!1,window.bukeyongbool=!1;var result=null;api.post($http,$scope,api.path.mbuylogic,"Coupons","GetCouponsListByUserID",param,function(obj){if(200!==obj.ErrorCode)return void api.toast(obj.ErrorMsg);if(result=JSON.parse(obj.JsonResult),$scope.keyonglist=result.keyongList,$scope.bukeyonglist=result.bukeyongList,null!=$scope.keyonglist&&$scope.keyonglist.length>0&&(keyongbool=!0),null!=$scope.bukeyonglist&&$scope.bukeyonglist.length>0&&(bukeyongbool=!0),void 0!==$scope.keyonglist&&null!==$scope.keyonglist||void 0!==$scope.bukeyonglist&&null!==$scope.bukeyonglist)$(".no-coupons-now").hide();else{var html='<div class="no-coupons-now"><div class="bg"></div><p>暂无优惠券，可使用优惠码添加</p></div>';0===$("#J_router_selectcoupons").find(".no-coupons-now").length?$("#J_router_selectcoupons").append(html):$(".no-coupons-now").show()}},0,!1)}},$scope.addcoupons=function($event){var classname=$event.target.getAttribute("class");if("button active"===classname){var activecode=$(".coupons").find("[type=text]").val(),param=JSON.stringify({userId:api.getUser().userId,productId:pId,prepayMent:$scope.TourTotalPrice,cityId:$scope.StartCityID,sumPerson:$scope.TotalPerson,platfrom:api.isApp()?"APP客户端":"触屏版",uActiveCode:activecode});if($scope.VerificationUActiveCode())return void api.toast("优惠券已存在");api.post($http,$scope,api.path.mbuylogic,"Coupons","AddCoupons",param,function(obj){if(200===obj.ErrorCode)api.toast(obj.ErrorMsg),$(".search").find("input").val(""),$(".coupons").find(".button").removeClass("active"),$scope.keyonglist.unshift(JSON.parse(obj.JsonResult));else{if(201!==obj.ErrorCode)return void api.toast(obj.ErrorMsg);api.toast(obj.ErrorMsg),$(".search").find("input").val(""),$(".coupons").find(".button").removeClass("active"),$scope.bukeyonglist.unshift(JSON.parse(obj.JsonResult))}},0,!1)}},$scope.VerificationUActiveCode=function(){for(var isExixt=!1,activecode=$(".coupons").find("[type=text]").val().toLowerCase(),i=0;i<$scope.keyonglist.length;i++)$scope.keyonglist[i].UActiveCode.toLowerCase()===activecode&&(isExixt=!0);for(var _i2=0;_i2<$scope.bukeyonglist.length;_i2++)$scope.bukeyonglist[_i2].UActiveCode.toLowerCase()===activecode&&(isExixt=!0);return isExixt};var goDate="",adultCount=0,childCount=0,pId="",jouneryGroupId=0,para=api.getQueryString("para");if(null!==para&&""!==para){var _arrayAttr=para.split("_");pId=parseInt(_arrayAttr[0]),adultCount=parseInt(_arrayAttr[1]),childCount=parseInt(_arrayAttr[2]),goDate=_arrayAttr[3],jouneryGroupId=parseInt(_arrayAttr[4]),uzaiTravelClassId=parseInt(_arrayAttr[5])}$scope.BackProduct=function(){if(api.getQueryString("source_url"))bridge.goBack("https://mhd.uzai.com/"+api.getQueryString("source_url"),!0,!1,1);else{var _url="https://m.uzai.com/product/calendar.html?productid="+pId;location.href=_url}},$scope.BackOrderList=function(){api.isApp()&&_OrderID>0&&_OrderType>0?bridge.openOrderDetail(_OrderID,_OrderType):location.href="https://u.uzai.com/mobile/order"},$scope.LoadDataInit=function(isRefreshChildPage){var param=JSON.stringify({goDate:goDate,adultCount:adultCount,childCount:childCount,productId:pId,userid:api.getUser().userId,jouneryGroupId:jouneryGroupId,VStoreId:$vstoreid});if(null===api.getUser().userId||void 0===api.getUser().userId||""===api.getUser().userId){if(!api.isApp()||!api.getQueryString("userid"))return void console.log("userid获取失败");var param1=JSON.parse(param);param1.userid=api.getQueryString("userid"),param=JSON.stringify(param1)}api.post($http,$scope,api.path.mbuylogic,"UzaiOrder","GetBookingInitInfo",param,function(obj){if(200===obj.ErrorCode){$(".uzai-wrapper").show();var result=JSON.parse(obj.JsonResult);if(1===result.IsSecKill){var _url2="https://buy.uzai.com/touch_one/";_url2+=goDate+"/",_url2+=adultCount+"/"+childCount+"/",_url2+=result.AdultPrice+"/"+result.ChildPrice+"/"+pId+"/"+api.getUser().userId+".html?phoneid=",window.location.href=_url2}if($isNeedTraveller=result.IsNeedTraveller,$scope.TravellerText=result.TravellerText,$scope.SubmitText=result.SubmitText,$scope.contactName=result.UserName,$scope.contactPhone=parseInt(result.Phone),$scope.email=result.Email,$scope.StartCity=result.StartCity,$scope.StartCity=$scope.StartCity.substring(0,$scope.StartCity.lastIndexOf("市")),$scope.StartCityID=result.StartCityID,$scope.goDate=goDate,$scope.adultCount=adultCount,$scope.childCount=childCount,$scope.JouneryGroupName=result.JouneryGroupName,$scope.ProductName=result.ProductName,$scope.AdditionalProduct=result.AdditionalProducts,$scope.locationid=result.locationid,$scope.locationname=result.locationname,$scope.SupplierStore=result.SupplierStore,$scope.PayType=result.PayType,1e4===result.Point?$scope.Point_text=String(result.Point).substring(0,String(result.Point).length-4)+"万":String(result.Point).length>4&&($scope.Point_text=String(result.Point).substring(0,String(result.Point).length-4)+"万＋"),$scope.Point=parseInt(result.Point),$scope.OrderTotalPrice=result.OrderTotalPrice,$scope.TourTotalPrice=result.OrderTotalPrice,$scope.AdditionToalPrice=0,$scope.PreferentialTotalPrice=0,$scope.CouponsPrice=0,$scope.ScoreRatio=result.ScoreRatio,$scope.AllExchangeMoney=parseInt(result.ExchangeMoney),$scope.ExchangeMoney=parseInt(result.ExchangeMoney),$scope.StoreMapDomain=result.StoreMapDomain,$scope.isUsePoint=!1,$scope.isUseCoupons=!1,$scope.MinOrderNumber=result.MinOrderNumber,1===result.IsShowPoint?$("#PointDiv").show():($("#PointDiv").hide(),$("#checkPoint").addClass("hook_h"),$scope.isUsePoint=!1),0===$scope.ExchangeMoney&&($scope.isUsePoint=!1),$scope.TotalPerson=parseInt(adultCount+childCount),$scope.uzaiProductTourDate=result.uzaiProductTourDate,$scope.BoardingLocationList=result.BoardingLocationList,null!==$scope.BoardingLocationList&&$scope.BoardingLocationList.length>0){var _bdlocationdefault=$scope.BoardingLocationList[0];_BoardingLocationStr=_bdlocationdefault.BoardingTime+"^"+_bdlocationdefault.DepartLocation+"^"+_bdlocationdefault.BackLocation}if(null!=$scope.SupplierStore&&($scope.StoreId=$scope.SupplierStore.StoreId,$scope.selected=result.SupplierStore.UzaiCity,$scope.areaSelected=result.SupplierStore.Area),$scope.IsShowPreferential=result.IsShowPreferential,$vstoreid>0||!result.TourIsShowStoreInfo)$scope.Telphone=result.CustomServicePhone,$scope.isshowstoreinfo=!1;else if($scope.isshowstoreinfo=!0,null!==result.GetCustomTelList)for(var i=0;i<result.GetCustomTelList.length;i++)1===result.GetCustomTelList[i].Type?"ios"===deviceType&&($scope.Telphone=result.GetCustomTelList[i].Telephone):2===result.GetCustomTelList[i].Type?"android"===deviceType&&($scope.Telphone=result.GetCustomTelList[i].Telephone):20===result.GetCustomTelList[i].Type&&"ios"!==deviceType&&"android"!==deviceType&&($scope.Telphone=result.GetCustomTelList[i].Telephone);if(PreferentialList(result.PreferentialSolution,$scope),$(".detailed").click(function(){var strSafeHtml="",strAddHtml="";$("#add-safe").find(".foot_detailed_lipro").each(function(){$(this).remove()}),$("#additionalPro").find(".foot_detailed_lipro").each(function(){$(this).remove()}),$(this).hasClass("detailed_hover")?($("html, body").css("overflow","visible"),$("html, body").css("height","auto"),$(".foot_detailed").removeClass("foot_detailed_hover"),$(".bg_000").hide(),$(this).removeClass("detailed_hover"),$(this).children("i").addClass("icon-top").removeClass("icon-bottom")):($(".bg_000").show(),$(this).addClass("detailed_hover"),$(this).children("i").addClass("icon-bottom").removeClass("icon-top"),$("#additionList").find(".main4_m1").each(function(){var addtype=$(this).find(".add-type").eq(0).val(),num=$(this).find(".main4_m1_right2").html(),price=$(this).find(".add-price").html(),additionName=$(this).find(".add-name").html(),strPrice="";strPrice=0>price?"-￥"+price.substring(1):"￥"+price,3===addtype?strSafeHtml+='<div class="foot_detailed_lipro"><span class="left">'+additionName+'</span><span class="right">'+strPrice+"*"+num+"</span></div>":num>0&&(strAddHtml+='<div class="foot_detailed_lipro"><span class="left">'+additionName+'</span><span class="right">'+strPrice+"*"+num+"</span></div>")}),""===strSafeHtml?$("#add-safe").hide():($("#add-safe").show(),$("#add-safe").append(strSafeHtml)),""===strAddHtml?$("#additionalPro").hide():($("#additionalPro").show(),$("#additionalPro").append(strAddHtml)),setTimeout(function(){$("html, body").css("overflow","hidden"),$("html, body").css("height","100%"),$(".foot_detailed").addClass("foot_detailed_hover")},50)),$scope.isUseCoupons||$scope.isUsePoint||$scope.DetailPreferential.length>0?$("#sPreferentialDetail").show():$("#sPreferentialDetail").hide(),$scope.isUsePoint&&$scope.IsStandard?($("#point-detail").show(),$("#point-detail-price").html("-¥"+$scope.ExchangeMoney)):$("#point-detail").hide(),$scope.isUseCoupons&&$scope.IsStandard?($("#coupons-detail").show(),$("#coupons-detail-price").html("-¥"+$scope.CouponsPrice)):$("#coupons-detail").hide()}),$("#checkPoint").click(function(){$(this).hasClass("hook_h")?($(this).removeClass("hook_h"),$scope.isUsePoint=!0):($(this).addClass("hook_h"),$scope.isUsePoint=!1),CaluateTotalPrice($scope)}),isRefreshChildPage&&""!==api.getUser()&&null!==api.getUser()&&"undefined"!=typeof api.getUser()&&!api.isApp()){var _htmlname=location.href.split("#")[1];"/selectcoupons"===_htmlname?$scope.couponsinit():"/travepeople"===_htmlname?$scope.trave_people_init(!0):"/editpeople"===_htmlname?$scope.trave_people_init(!0):"/changestore"===_htmlname&&$scope.changeStore()}}else api.toast(obj.ErrorMsg)},0,!1)},$scope.editPeopleBack=function(){api.endloading(),location.href="#/travepeople"},$scope.submitForm=function(){var orderSource="";if(api.isApp())"android"===deviceType?orderSource="android客户端":"ios"===deviceType&&(orderSource="iphone客户端");else{var _ua=navigator.userAgent.toLowerCase();orderSource="ipad"===_ua.match(/ipad/i)?"ipad客户端":"M站"}var contactName=$("#contactName").val();if(""===contactName)return popup("联系人姓名！"),void $("#contactName").focus();if(contactName.length>20)return popup("请填写正确的联系人姓名！"),$("#contactName").focus(),void $("#contactName").css("color","#f00");$("#contactName").css("color","#666666");var rep=new RegExp(/^[a-zA-Z\u4e00-\u9fa5]{2,20}$/);if(!rep.test(contactName))return void popup("请填写正确的联系人姓名！");var contactPhone=$("#contactPhone").val();if(""===contactPhone)return popup("请填写联系人手机号！"),void $("#contactPhone").focus();var reP=new RegExp(/^1[3|4|5|7|8]\d{9}$/);if(!reP.test(contactPhone))return $("#contactPhone").css("color","#f00"),void popup("请填写正确的联系人手机号！");$("#contactPhone").css("color","#444");var email=$("#email").val();if(""!==email){var reP1=new RegExp(/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/);if($scope.email=email,!reP1.test($scope.email))return $("#email").css("color","#f00"),void popup("请填写正确的邮箱！");$("#email").css("color","#666666");
}if($("#choseTravelList").find(".travel_list").length<$scope.TotalPerson&&1===$isNeedTraveller)return void popup("请选择"+$scope.TotalPerson+"位出游人！");var storeId=$("#storeId").val();if(0>=$vstoreid&&(""===$("#addressName").html()||""===storeId||"0"===storeId))return void popup("请选择门店！");window.addNum=0;var arr=new Array;$(".overhidd .main4_m1").each(function(){var addId=$(this).attr("id").split("_")[1],num=$(this).find(".main4_m1_right2").html();num>0&&arr.push({AdditionId:addId,BuyCount:num}),addNum++});var preferentialIds="",preferentialPrices="";if(null!==$scope.DetailPreferential&&void 0!==$scope.DetailPreferential)if($scope.IsStandard){for(var i=0;i<$scope.DetailPreferential.length;i++)$scope.isUseCoupons?2!==$scope.DetailPreferential[i].ParentTypeId&&(preferentialIds+=$scope.DetailPreferential[i].PreferentialId+",",preferentialPrices+=$scope.DetailPreferential[i].MaxPreAmount+","):(preferentialIds+=$scope.DetailPreferential[i].PreferentialId+",",preferentialPrices+=$scope.DetailPreferential[i].MaxPreAmount+",");""!==preferentialIds&&(preferentialIds=preferentialIds.substring(0,preferentialIds.lastIndexOf(",")),preferentialPrices=preferentialPrices.substring(0,preferentialPrices.lastIndexOf(","))),$(".coupons").find(".choose-coupons").each(function(){$(this).hasClass("activing")&&($scope.isUseCoupons=!0)})}else preferentialIds=$scope.DetailPreferential.PreferentialId,preferentialPrices=$scope.DetailPreferential.MaxPreAmount,$scope.isUsePoint=!1,$scope.isUseCoupons=!1;var travelIds="",travelIdAndPaperIds="";if($("#choseTravelList").find(".travel_list").each(function(){var travelId=$(this).find("#travelId").val(),paperKeyId=$(this).find("#paperkeyid").val();travelIds+=travelId+",",travelIdAndPaperIds+=travelId+","+paperKeyId+"|"}),""!==travelIds&&(travelIds=travelIds.substring(0,travelIds.lastIndexOf(","))),$scope.OrderTotalPrice<=0)return void popup("优惠大于应付金额请联系客服协助您预订");var usePoint=$scope.ExchangeMoney*$scope.ScoreRatio,channelstr=api.getCookie("uzmCooperateSource"),channelId="";""!==channelstr&&void 0!==channelstr&&null!==channelstr&&3===channelstr.split(":").length&&(channelId=channelstr.split(":")[2]);var $bookcityid="0",$baomincityname="";null!==api.getCookie("bookingcityid")&&void 0!==api.getCookie("bookingcityid")&&api.getCookie("bookingcityid")>0?$bookcityid=api.getCookie("bookingcityid"):null!==api.getCookie("bookingcityname")&&void 0!==api.getCookie("bookingcityname")&&($baomincityname=api.getCookie("bookingcityname"));var param=JSON.stringify({ContactName:$scope.contactName,ChildCount:childCount,AdultCount:adultCount,ContactPhone:$scope.contactPhone,Email:$scope.email,Remark:$("#remark").val().trim(),ProductId:pId,DeviceCode:api.getCookie("phoneid"),UserId:api.getUser().userId,SupplierID:storeId,PreferentialIds:preferentialIds,GoDate:goDate,OrderSource:orderSource,IsUseCoupons:$scope.isUseCoupons,IsUsePoint:$scope.isUsePoint,CouponsCode:$("#activecode").val(),GoOutPersonIds:travelIds,ChooseAdditionProList:arr,preferentialPrices:preferentialPrices,UsePoint:usePoint,ChannelId:channelId,VStoreId:$vstoreid,BookCityId:$bookcityid,Baomincityname:$baomincityname,AppVersion:appversion,BoardingLocation:_BoardingLocationStr,TravelIdAndPaperIds:travelIdAndPaperIds,IsNeedTraveller:$isNeedTraveller});api.post($http,$scope,api.path.mbuylogic,"UzaiOrder","InsertOrder",param,function(obj){var commite_title=document.getElementsByClassName("commite-title")[0],commite_dec=document.getElementsByClassName("commite-dec")[0],commite_sure=document.getElementsByClassName("commite-sure")[0],commite_back=document.getElementsByClassName("commite-back")[0];if(200===obj.ErrorCode){if(null!==obj.JsonResult&&void 0!==obj.JsonResult){var _arr=obj.JsonResult.split("_");if(6===_arr.length){_OrderID=_arr[2],_OrderType=_arr[3];var commtietype=parseInt(_arr[5]),commite_pop=document.getElementsByClassName("commite-pop")[0],cal_mask=document.getElementsByClassName("cal-mask")[0];if(3===commtietype)commite_pop.classList.remove("hide"),cal_mask.classList.remove("zHide"),commite_title.innerHTML="订单已提交",commite_dec.innerHTML="由于库存发生变化，稍后我们的客服专员将确认库存并尽快与您取得联系",commite_sure.classList.remove("hide"),commite_back.classList.add("hide");else if(2===commtietype)commite_pop.classList.remove("hide"),cal_mask.classList.remove("zHide"),commite_title.innerHTML="订单已提交",commite_dec.innerHTML="稍后我们的客服专员会尽快与您联系",commite_sure.classList.remove("hide"),commite_back.classList.add("hide");else{popup(obj.ErrorMsg);var payUrl="https://mpay.uzai.com/pay/index.html?ordercode="+_arr[0]+"&tuanId="+_arr[1]+"&minOrderNumber="+$scope.MinOrderNumber;if(0===$scope.PayType||"0"===_arr[4])$scope.BackOrderList();else if(api.isApp()){var pageBaseParam={Url:"",IsTabBar:!1,Content:{},TabBarIndex:0,ServicesInfo:{},ClassInfo:{},GA:api.getLocalStorage("GA"),IsNav:!0},pageParam=window.deepClone(pageBaseParam);"ios"===deviceType?(pageParam.ClassInfo={ClassName:"UZNewPayVC",isStoryBoard:"0",cocoaPodName:"UZWebModule",isXib:!1},pageParam.Content={PayUrl:payUrl}):"android"===deviceType&&(pageParam.ClassInfo={ClassName:"com.uzai.app.mvp.module.hybrid.activity.PayWebActivity550",isStoryBoard:"0"},pageParam.Content={PayUrl:payUrl}),api.invoke("open.page",encodeURI(JSON.stringify(pageParam)))}else api.loading(),location.href=payUrl}}}}else if(202===obj.ErrorCode){api.toast(obj.ErrorMsg);var result=JSON.parse(obj.JsonResult);PreferentialList(result,$scope)}else if(-2===obj.ErrorCode){var _commite_pop=document.getElementsByClassName("commite-pop")[0],_cal_mask=document.getElementsByClassName("cal-mask")[0];_commite_pop.classList.remove("hide"),_cal_mask.classList.remove("zHide"),commite_title.innerHTML="余位不足，无法预订",commite_dec.innerHTML="请您选择其他日期或者产品",commite_sure.classList.add("hide"),commite_back.classList.remove("hide")}else{if(api.toast(obj.ErrorMsg),-3===obj.ErrorCode&&"android"===deviceType)return!1;setTimeout(function(){location.href=url},2e3)}},0,!1)},$scope.CheckPreferntial=function(){$("#simple").is(":checked")?($(".standard_discount").eq(1).addClass("red_hover").siblings().removeClass("red_hover"),$scope.IsStandard=!0,void 0!==$scope.StandardPreferential&&null!=$scope.StandardPreferential&&($scope.DetailPreferential=$scope.StandardPreferential.Activities),$("#bank_list_url").hide()):($(".standard_discount").eq(0).addClass("red_hover").siblings().removeClass("red_hover"),$scope.IsStandard=!1,$scope.DetailPreferential=$scope.DefautBanKPreferential,$("#bank_list_url").show()),$scope.isUsePoint&&$scope.IsStandard?($("#point-detail").show(),$("#point-detail-price").html("-¥"+$scope.ExchangeMoney)):$("#point-detail").hide(),$scope.isUseCoupons&&$scope.IsStandard?($("#coupons-detail").show(),$("#coupons-detail-price").html("-¥"+couponsPrice)):$("#coupons-detail").hide(),CaluateTotalPrice($scope)},$scope.ChooseBankPreferntial=function(obj,thisObj){$("#b_"+thisObj).addClass("myActive").find(".circle i").show().parents(".bank-red-bg").siblings(".bank-red-bg").find(".bank-discount").removeClass("myActive").find(".circle i").hide(),$scope.DefautBanKPreferential=obj,$scope.DetailPreferential=$scope.DefautBanKPreferential,CaluateTotalPrice($scope),$("#simple").removeAttr("checked"),setTimeout(function(){api.routerGoBack()},100)},$scope.ChooseCoupons=function(id){if($("#"+id).parent().parent().hasClass("activing"))$("#"+id).parent().parent().removeClass("activing"),$scope.isUseCoupons=!1,$scope.CouponsPrice=0,void 0!==$scope.SubTypeName&&""!==$scope.SubTypeName?$("#chooseCoupons").html("<i ng-if=\"SubTypeName!=''&& SubTypeName!=undefined\">与"+$scope.SubTypeName+"不可同享</i>"):$("#chooseCoupons").html("");else{if($scope.isUseCoupons=!0,couponsPrice=$("#"+id).parent().prev().find(".cou_price").val(),$scope.OrderTotalPrice<=parseInt(couponsPrice))return api.toast("优惠>=应付，无法使用该优惠券"),void($scope.isUseCoupons=!1);if($("#"+id).parent().parent().addClass("activing").siblings(".choose-coupons").removeClass("activing"),void 0!==couponsPrice&&null!==couponsPrice&&""!==couponsPrice){var type=$("#"+id).attr("ty"),coupons=0;if("2"===type){var maxPrice=$("#"+id).next().val();coupons=$scope.TourTotalPrice-parseInt($scope.TourTotalPrice*couponsPrice/100),coupons>maxPrice&&(coupons=maxPrice),$("#chooseCoupons").html("已选抵 <b>"+coupons+"</b> 元优惠券<input type='hidden' id='activecode' value='"+id+"' />"),$scope.CouponsPrice=coupons}else $scope.CouponsPrice=couponsPrice,$("#chooseCoupons").html("已选抵 <b>"+couponsPrice+"</b> 元优惠券<input type='hidden' id='activecode' value='"+id+"' />")}else $scope.couponsPrice=0;$("#"+id).addClass("activing").siblings(".choose-coupons").removeClass("activing")}CaluateTotalPrice($scope),api.routerGoBack()},$scope.ContactBook=function(){bridge.contactList()},$scope.AdditionAdd=function(addId,maxNum){for(var id="add_"+addId,obj=$("#"+id).find(".j_add"),japan=0,i=0;i<obj.parent().find(".main4_m1_right2").length;i++)japan+=parseInt(obj.parent().find(".main4_m1_right2").eq(i).html());surplus=maxNum-japan;var val=obj.prev().children(".main4_m1_right2").html();surplus>0?(obj.prev().children(".main4_m1_right2").html(++val),obj.parent().find(".main4_m1_right1, .main4_m1_right3").removeClass("hover"),obj.children(".main4_m1_right3").addClass("hover"),obj.siblings(".j_remove").children(".main4_m1_right1").addClass("sure"),1===surplus&&obj.parent().find(".main4_m1_right3").removeClass("hover sure")):obj.parent().find(".main4_m1_right3").removeClass("hover sure"),CaluateTotalPrice($scope)},$scope.AdditionRemove=function(addId){var id="add_"+addId,obj=$("#"+id).find(".j_remove");if(obj.children(".main4_m1_right1").hasClass("sure")){obj.parent().find(".main4_m1_right3").addClass("sure");var val=obj.next().children(".main4_m1_right2").html();parseInt(val)<=1?(obj.children(".main4_m1_right1").removeClass("hover sure"),obj.next().children(".main4_m1_right2").html("0")):(obj.next().children(".main4_m1_right2").html(--val),obj.parent().find(".main4_m1_right1, .main4_m1_right3").removeClass("hover"),obj.children(".main4_m1_right1").addClass("hover"))}CaluateTotalPrice($scope)},$scope.ChooseStore=function(obj){var storeId="s_"+obj.StoreId;$("#"+storeId).addClass("active").siblings().removeClass("active"),$scope.SupplierStore=obj,api.routerGoBack()};var htmlname=location.href.split("#")[1];"/"===htmlname||void 0===htmlname||null===htmlname?$scope.LoadDataInit():$scope.LoadDataInit(!0)}),uzai.filter("trustHtml",function($sce){return function(input){return $sce.trustAsHtml(input)}})}(window,document,jQuery,uzai);var surplus=1;window.androidGoBack=androidGoBack,window.validate=validate,window.ValidateNumber=function(obj,num){$(obj).val($(obj).val().slice(0,num))},function(){var o=["qq.com","126.com","163.com","188.com","139.com","189.cn","sina.com","sohu.com","vip.sina.com","vip.qq.com","vip.sohu.com","vip.163.com","gmail.com","wo.com.cn","hotmail.com","foxmail.com","21cn.com","yeah.net","yahoo.com","msn.com","outlook.com","zhihu.com","live.com","tom.com"],frist_email=$("#email");$(frist_email).on("input",function(){var t=$(this).val(),i=$(this).next(".js-prompt-input");if(t.length){var e=t.split("@");if(1===e.length)i.val(t+"@"+o[0]);else if(e.length>2)i.val("");else if(""===e[1])i.val(t+o[0]);else{for(var n=0,l=o.length;l>n;n++)if(("@"+o[n]).indexOf("@"+e[1])>-1)return i.val(t+o[n].replace(new RegExp(e[1]),""));i.val("")}}else $(this).val(""),i.val("")}),$(frist_email).on("blur",function(){var t=$(this).next(".js-prompt-input"),o=t.val();t.val(""),""!==o&&$(this).val(o)})}(),$(function(){$("textarea").bind({input:function(){this.style.height="auto",this.style.height=this.scrollHeight+"px",0===$(this).val().length?$(".main5_m i").show():$(".main5_m i").hide()}}),$("#choseTravelList").parent().find(".main4_m1_more").click(function(){if($(this).hasClass("click_hover")){var he=$(this).data("height");he--,$(this).prev().children().eq(he).nextAll().hide(),$(this).removeClass("click_hover"),$(this).children("i").addClass("icon-bottom").removeClass("icon-top")}else $(this).prev().children().show(),$(this).addClass("click_hover"),$(this).children("i").addClass("icon-top").removeClass("icon-bottom")}),$(".foot_detailed_top .right, .bg_000").click(function(){$(".detailed").click()}),""===$("#choseTravelList").html()?$("#choseTravelList").parent().hide():$("#choseTravelList").parent().show(),$("#point-detail").hide(),$("#coupons-detail").hide(),$("#additionList").find(".main4_m1").length>3?$("#additionList").next().show():$("#additionList").next().hide()}),function(window,$,uzai){uzai.directive("travelPeople",function(){return{restrict:"AE",link:function(scope,elm,attr){scope.$last===!0&&(setTimeout(function(){for(var i=0;i<editpeopleId.length;i++)$("[paperid="+editpeopleId[i]+"]").parent().prev().addClass("choose-yes")},300),$(".trave-people ul li dl").click(function(){var $this=$(this),$active=$this.find(".choosing"),num=$(".choose-yes").next().length;num<scope.TotalPerson?$active.is(".choose-yes")?$active.removeClass("choose-yes"):$active.addClass("choose-yes"):$active.is(".choose-yes")?$active.removeClass("choose-yes"):!1}))}}}),uzai.directive("editPeople",function(){return{restrict:"AE",link:function(scope,elm,attr){scope.$last===!0,setTimeout(function(){""!==$(".edit-people ul li .lineTime").val()?($(".edit-people ul li .lineTime").css("color","#666"),$(".edit-people ul li .lineTime").next().css("display","none")):($(".edit-people ul li .lineTime").css("color","#fff"),$(".edit-people ul li .lineTime").next().css("display","inline-block"))},1e3),$(".edit-people ul li .name-tips").hide()}}}),uzai.directive("editChoose",function(){return{restrict:"AE",link:function(scope,elm,attr){$("#J_router_travepeople").on("click","#payment-common-pop .ok-btn",function(){var $mask=$(".edit-mask-bg"),$pop=$("#payment-common-pop");$mask.fadeOut(),$pop.hide()}).on("click","#payment-common-pop .cancel-btn",function(){var $mask=$(".edit-mask-bg"),$pop=$("#payment-common-pop");$mask.fadeOut(),$pop.hide()})}}}),uzai.directive("editDate",function(){return{restrict:"AE",link:function(scope,elm,attr){$("#J_router_editpeople").on("click",".edit-people li .hideElement:eq(0)",function(){var $this=$(this);$this.find("em").hide(),$this.find(".date").focus()}).on("blur",".edit-people li .date,.edit-people li .lineTime",function(){var $this=$(this);return""===$this.val()?$this.next().css("display","inline-block"):""}).on("click",".edit-people li .hideElement2",function(){var $this=$(this);$this.find("em").hide().prev().focus()})}}}),uzai.directive("changeStore",function(){return{restrict:"AE",link:function(scope,elm,attr){scope.$last===!0}}}),uzai.directive("selectcouponskeyong",function(){return{restrict:"AE",link:function(scope,elm,attr){scope.$last===!0&&($(".no-coupons .right>span,.choose-coupons .right>span").click(function(e){e.preventDefault(),e.stopPropagation();var $this=$(this);return $this.find("i").hasClass("active")?$this.find("i").removeClass("active").parents(".right").siblings(".explain").hide():$this.find("i").addClass("active").parents(".right").siblings(".explain").show()}),$(".choose-coupons .explain, .no-coupons .explain").click(function(){return!1}))}}}),uzai.directive("selectcouponsbukeyong",function(){return{restrict:"AE",link:function(scope,elm,attr){scope.$last===!0&&$(".no-coupons .right>span").click(function(){var $this=$(this);return $this.find("i").hasClass("active")?$this.find("i").removeClass("active").parents(".right").siblings(".explain").hide():$this.find("i").addClass("active").parents(".right").siblings(".explain").show()})}}}),uzai.directive("selectCouponsInput",function(){return{restrict:"AE",link:function(scope,elm,attr){$("#J_router_selectcoupons").on("click",".coupons-search .search .close",function(){var $this=$(this),$input=$this.prev(),$button=$(".coupons-search .button");$input.val(""),$(".search .into").show(),$button.removeClass("active"),$this.hide()})}}}),uzai.directive("selectbankdiscount",function(){return{restrict:"AE",link:function(scope,elm,attr){scope.$last===!0&&$(".bank-discount").eq(0).addClass("myActive"),api.endloading()}}}),uzai.directive("addFinish",function($timeout){return{restrict:"AE",link:function(scope,elm,attr){scope.$last===!0&&(setTimeout(function(){$("#additionList").find(".main4_m1").each(function(index){index>2&&$(this).css("display","none");var type=$(this).find(".add-type").val();"11"!==type&&"16"!==type&&"19"!==type&&"21"!==type||($(this).find(".j_remove").children(".main4_m1_right1").addClass("sure"),$(this).find(".j_add").children(".main4_m1_right3").removeClass("sure")),scope.TotalPerson%2===1&&"13"===type&&($(this).find(".main4_m1_right2").html("1"),1===scope.TotalPerson&&($(this).find(".j_remove").children(".main4_m1_right1").addClass("sure"),$(this).find(".j_add").children(".main4_m1_right3").removeClass("sure")))}),CaluateTotalPrice(scope)},500),$("#additionList").parent().find(".main4_m1_more").click(function(){if($(this).hasClass("click_hover")){var he=$(this).data("height");he--,$(this).prev().children().eq(he).nextAll().hide(),$(this).removeClass("click_hover"),$(this).children("i").addClass("icon-bottom").removeClass("icon-top")}else $(this).prev().children().show(),$(this).addClass("click_hover"),$(this).children("i").addClass("icon-top").removeClass("icon-bottom")}),window.maxNum=scope.TotalPerson,$("#additionList").find(".main4_m1").length>3?$("#additionList").next().show():$("#additionList").next().hide())}}}),uzai.directive("script",function($compile){return{restrict:"E",scope:!1,link:function(scope,elem,attr){if("text/javascript-lazy"===attr.type||elem.text().indexOf("childrenFunction.")>-1){if(attr.ngSrc){var script=document.createElement("script");return script.setAttribute("type","text/javascript"),script.setAttribute("src",attr.ngSrc),void document.body.appendChild(script)}var code=elem.text(),f=new Function(code);f()}}}})}(window,jQuery,uzai),window.childrenFunction={travepeople:function(){null!==scopeObj.contacters&&void 0!==scopeObj.contacters&&api.endloading(),new ScrollIOS("trave-wrapper","travepeople")},changestore:function(){new ScrollIOS("store-wrapper","changestore")},editpeople:function(){if(console.log("editpeople"),$("#edit-wrapper").css("height",$height),$("#passportofpaper").val(editpapertypeselect),$(".edit-people").on("focus","ul li .lineTime",function(){$(".uzai-wrapper").hide()}).on("blur","ul li .lineTime",function(){$(".uzai-wrapper").show(),""===$(".edit-people ul li .lineTime").val()?($(".edit-people ul li .lineTime").next().css("display","inline-block"),$(".edit-people ul li .lineTime").val("").css("color","#fff")):($(".edit-people ul li .lineTime").next().css("display","none"),$(".edit-people ul li .lineTime").css("color","#666"))}).on("click","ul li",function(){var $this=$(this),$input=$this.find("input");$input.focus()}),$(".document-information").on("click","ul li:eq(3)",function(){var $this=$(this),$val=$this.find("input").val();""!==$val?($this.find("input").css("color","#666"),$this.find("input").next().css("display","none")):($this.find("input").css("color","#fff"),$this.find("input").next().css("display","inline-block"))}),$(".edit-people").on("focus","ul li .defaultP",function(){var $wrapper=$(".uzai-wrapper");$wrapper.hide()}).on("blur","ul li .defaultP",function(){var $wrapper=$(".uzai-wrapper");$wrapper.show()}),$(".edit-people ul li .name-tips").hide(),/(iPhone|iPad|iPod|iOS)/i.test(navigator.userAgent)){var windowTop=0;$("#edit-wrapper").scroll(function(){var scrolls=$(this).scrollTop();if(scrolls>=windowTop){windowTop=scrolls;var el=document.activeElement;if("input"===el.nodeName.toLowerCase())return void el.blur()}else{windowTop=scrolls;var _el=document.activeElement;if("input"===_el.nodeName.toLowerCase())return void _el.blur()}})}else if(/(Android)/i.test(navigator.userAgent)){var winHeight=window.innerHeight;window.addEventListener("resize",function(e){var tempHeight=window.innerHeight;winHeight>tempHeight?$(".justBg").css("height","6rem"):$(".justBg").css("height","2rem")})}""!==api.getCookie("travelId")?scopeObj.LoadPaperType():($("#title").html("添加出游人信息"),$(".date").val("").attr("value","").next().hide(),$(".edit-people ul li .lineTime").next().css("display","inline-block"),$(".edit-people ul li .lineTime").css("color","#fff"),$(".lineTime").val("").attr("value","").next().hide(),$("#paperinfo").addClass("hide"),$("#paperplaceinfo").addClass("hide"),$("#paperdateinfo").addClass("hide"),scopeObj.LoadPaperType(),console.log("2105LoadPaperType")),new ScrollIOS("edit-wrapper","editpeoeple"),$(".basic-information ul li .sex").click(function(){var $this=$(this);$this.addClass("active").siblings(".sex").removeClass("active")})},selectcoupons:function(){new ScrollIOS("coupons-wrapper","selectcoupons"),$(".coupons-header .mark").click(function(){var $mask=$(".cal-mask1"),$pop=$("#cal-pop");$mask.show(),$pop.fadeIn()}),$("#cal-pop .icon-guanbi,.cal-mask1").click(function(){var $mask=$(".cal-mask1"),$pop=$("#cal-pop");$mask.fadeOut(),$pop.hide()}),$("body").on("focus",".coupons-search input",function(){var $this=$(this);$this.prev().hide().end().next().show()}).on("blur",".coupons-search input",function(){var $this=$(this),$into=$(".search .into"),$val=$this.val();return""===$val?$into.show().siblings(".close").hide():""}).on("input",".coupons-search input",function(){var $this=$(this),$button=$this.parents(".search").siblings(".button");return $this.val().length>9?$button.addClass("active"):$button.removeClass("active")}).on("click",".coupons-header .mark",function(){}).on("click","#cal-pop .icon-guanbi,#cal-pop .icon-guanbi,.cal-mask1",function(){var $mask=$(".cal-mask1"),$pop=$("#cal-pop"),$paymentPop=$("#payment-common-pop1"),$pop1=$("#cal-pop1");$mask.fadeOut(),$pop.hide(),$paymentPop.hide(),$pop1.hide()})},bankdiscount:function(){new ScrollIOS("bank-wrapper","selectcoupons")},bdlocation:function(){api.endloading(),setTimeout(function(){var winh=window.innerHeight;document.getElementById("J_router_bdlocation").style.height=winh+"px";for(var _bdlocaionmk=document.getElementsByClassName("bdlocaion-mk"),i=0;i<_bdlocaionmk.length;i++)_bdlocaionmk[i].onclick=function(){Array.prototype.filter.call(_bdlocaionmk,function(child){child.classList.remove("active")}),this.classList.add("active"),_BoardingLocationStr="";for(var _chooseitags=this.getElementsByTagName("i"),_bdlocaions=document.getElementById("BoardingLocationDiv").getElementsByClassName("bdlocaion"),_i4=0;_i4<_chooseitags.length;_i4++)_bdlocaions[_i4].getElementsByTagName("i")[0].innerText=_chooseitags[_i4].innerText,_BoardingLocationStr+=_bdlocaions[_i4].getElementsByTagName("i")[0].innerText+"^";this.getElementsByClassName("location-note").length>0?document.getElementById("BoardingLocationDiv").getElementsByClassName("location-note")[0].innerText=this.getElementsByClassName("location-note")[0].innerText:document.getElementById("BoardingLocationDiv").getElementsByClassName("location-note")[0].innerText="",api.routerGoBack()}},0)}},window.CaluateTotalPrice=function(scopeObj){var addPrice=0;if($(".overhidd").find(".main4_m1").each(function(){var num=$(this).find(".main4_m1_right2").html(),price=$(this).find(".add-price").html();addPrice+=price*num}),$(".coupons .choose-coupons").each(function(){$(this).hasClass("activing")&&(scopeObj.isUseCoupons=!0)}),scopeObj.AdditionToalPrice=addPrice,void 0!==scopeObj.DetailPreferential&&null!==scopeObj.DetailPreferential)if(scopeObj.IsStandard){for(var preferentialPrice=0,i=0;i<scopeObj.DetailPreferential.length;i++)scopeObj.isUseCoupons?2!==scopeObj.DetailPreferential[i].ParentTypeId&&(preferentialPrice+=parseInt(scopeObj.DetailPreferential[i].MaxPreAmount)):preferentialPrice+=parseInt(scopeObj.DetailPreferential[i].MaxPreAmount);scopeObj.PreferentialTotalPrice=preferentialPrice}else scopeObj.PreferentialTotalPrice=scopeObj.DetailPreferential.MaxPreAmount;if(scopeObj.OrderTotalPrice=scopeObj.TourTotalPrice+scopeObj.AdditionToalPrice-scopeObj.PreferentialTotalPrice,scopeObj.IsStandard)if(scopeObj.isUseCoupons&&(scopeObj.OrderTotalPrice<=scopeObj.CouponsPrice?($("#chooseCoupons").hide(),$(".coupons").find(".choose-coupons").each(function(){$(this).removeClass("activing")}),scopeObj.isUseCoupons=!1):($("#chooseCoupons").show(),scopeObj.OrderTotalPrice=scopeObj.OrderTotalPrice-scopeObj.CouponsPrice)),scopeObj.isUsePoint)if(scopeObj.OrderTotalPrice<scopeObj.AllExchangeMoney)if(scopeObj.OrderTotalPrice<=1)scopeObj.ExchangeMoney=0,$("#checkPoint").addClass("hook_h"),scopeObj.isUsePoint=!1;else{$("#checkPoint").removeClass("hook_h");var pointUseMoney=scopeObj.OrderTotalPrice-1;scopeObj.ExchangeMoney=pointUseMoney,$("#pointUseMoney").html(scopeObj.ExchangeMoney),scopeObj.OrderTotalPrice=1}else scopeObj.ExchangeMoney=scopeObj.AllExchangeMoney,scopeObj.OrderTotalPrice=scopeObj.OrderTotalPrice-scopeObj.ExchangeMoney,$("#pointUseMoney").html(scopeObj.ExchangeMoney);else scopeObj.OrderTotalPrice>scopeObj.AllExchangeMoney?(scopeObj.ExchangeMoney=scopeObj.AllExchangeMoney,$("#pointUseMoney").html(scopeObj.ExchangeMoney)):scopeObj.OrderTotalPrice<=1?(scopeObj.ExchangeMoney=0,$("#pointUseMoney").html(scopeObj.ExchangeMoney),$("#checkPoint").addClass("hook_h"),scopeObj.isUsePoint=!1):(scopeObj.ExchangeMoney=scopeObj.OrderTotalPrice-1,$("#pointUseMoney").html(scopeObj.ExchangeMoney));$("#totalPrice").html("￥"+scopeObj.OrderTotalPrice)},window.GetContectUserInfo=function(jsonStr){var result=JSON.parse(jsonStr);200!==result.ErrorCode&&"200"!==result.ErrorCode||null!==result.JsonResult&&void 0!==result.JsonResult&&($("#contactName").val(result.JsonResult.Name),$("#contactPhone").val(result.JsonResult.PhoneNumber))},window.editinit=function(){Booking_subPage.create()},$(function(){$("#point-help").click(function(){$(".cal-mask").eq(0).show().removeClass("hide"),$("#cal-pop1").fadeIn().removeClass("hide")}),$("#cal-pop1 .icon-guanbi,#cal-pop .icon-guanbi,.cal-mask").click(function(){$("#payment-common-pop1").hide(),$(".cal-mask").fadeOut(),$("#cal-pop1").hide()}),$(".cancel-btn").click(function(){$("#payment-common-pop1").hide(),$(".cal-mask").hide()}),api.isApp()?$("#contactBook").show():$("#contactBook").hide(),$("input,textarea").on("focus",function(){$("header").css({position:"absolute"}),$("footer").css({position:"absolute"}),$(".foot_detailed").hide(),$("html").css("position","relative")}),$("input,textarea").on("blur",function(){$("header").css({position:"fixed"}),$("footer").css({position:"fixed"}),$(".foot_detailed").show(),$("html").css("position","static")}),$("input, textarea").click(function(){return $(this).focus(),!1}),$("#wrapper").click(function(){$("input, textarea").blur()}),$(".foot_detailed_m").css("max-height",$(window).height()/2);var element=document.getElementById("foot_detailed_m");element.addEventListener("touchstart",function(e){var startTopScroll=element.scrollTop;0>=startTopScroll&&(element.scrollTop=1),startTopScroll+element.offsetHeight>=element.scrollHeight&&(element.scrollTop=element.scrollHeight-element.offsetHeight-1)}),document.addEventListener("touchmove",function(e){document.querySelectorAll(".foot_detailed")[0].classList.contains("foot_detailed_hover")&&$("#foot_detailed_m").offset().top>e.changedTouches[0].clientY&&e.preventDefault()})}),window.ScrollIOS=function(scrollName,routerName){var element=document.getElementById(scrollName),router=document.getElementById("J_router_"+routerName);element&&router&&element.addEventListener("touchstart",function(){var startTopScroll=element.scrollTop;0>=startTopScroll&&(element.scrollTop=1),startTopScroll+element.offsetHeight>=element.scrollHeight&&(element.scrollTop=element.scrollHeight-element.offsetHeight-1)})},noMouseWheel();var $height=$(window).height();