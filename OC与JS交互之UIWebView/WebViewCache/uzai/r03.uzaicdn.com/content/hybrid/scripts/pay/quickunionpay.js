!function(modules){function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={exports:{},id:moduleId,loaded:!1};return modules[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.loaded=!0,module.exports}var installedModules={};return __webpack_require__.m=modules,__webpack_require__.c=installedModules,__webpack_require__.p="",__webpack_require__(0)}([function(module,exports,__webpack_require__){"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_paycommon=__webpack_require__(1),uzai=angular.module("uzai",[]),userId=api.getQueryString("userId"),isSonOrder=!1;!function(window,document,$,uzai){function hanlderResponse(response){return 200===response.ErrorCode?!0:-3===response.ErrorCode?(api.toast("网络连接失败,请重试～"),!1):(api.toast(response.ErrorMsg,3e3),!1)}function randomNum(num){for(var strrandom="",i=0;num>i;i++)strrandom+=Math.floor(10*Math.random());return strrandom}function smsCodeType(){var smscode=document.getElementsByClassName("getyzm")[0],getspan=document.getElementsByClassName("tsyzm")[0];getspan.classList.add("hide"),smscode.classList.remove("hide"),smscode.innerText="获取验证码"}function androidGoBack(){var url="https://mpay.uzai.com/pay/index.html?orderCode="+orderCode;orderCode.indexOf("l")>-1&&(url="https://mpay.uzai.com/pay/individual-payment.html?ordercode="+orderCode),window.location.href=url}api.__asyncLoadingCode__="0";var devicetype=api.getQueryString("devicetype")||"wap",orderCode=api.getQueryString("orderCode"),PreferentialIds=api.getQueryString("preferentialIds")||"";if(""===api.getUser().userId||null===api.getUser().userId||"undefined"==typeof api.getUser().userId||""!==api.getCookie("EncyQuickLink")&&null!==api.getCookie("EncyQuickLink")&&!_typeof("undefined"===api.getCookie("EncyQuickLink")))if(""===api.getUser().userId||null===api.getUser().userId||"undefined"==typeof api.getUser().userId&&""!==api.getCookie("EncyQuickLink")&&null!==api.getCookie("EncyQuickLink")&&_typeof("undefined"!==api.getCookie("EncyQuickLink")))userId=api.getCookie("EncyQuickLink");else{var url="https://mpay.uzai.com/pay/index.html?orderCode="+orderCode;orderCode.indexOf("l")>-1&&(url="https://mpay.uzai.com/pay/individual-payment.html?ordercode="+orderCode),api.login(location.href,url)}else userId=api.getUser().userId;uzai.controller("QuickUnionPay",function($http,$scope,$compile){function quickpay(){var needCheck=!0;if(null!=$scope.quickpayment.OrderDetail.UzaiOrderSonList&&$scope.quickpayment.OrderDetail.UzaiOrderSonList.length>0){var paiedSonOrder=$scope.quickpayment.OrderDetail.UzaiOrderSonList.filter(function(sonOrder){return 1===sonOrder.State})[0];paiedSonOrder&&(needCheck=!1)}if(needCheck&&$scope.quickpayment.IsSplitSingle&&$scope.quickpayment.PrefIsExpired)return void api.toast("优惠已下线，无法完成支付，请联系客服",1500);var parameters=JSON.stringify({needCheck:needCheck,orderCode:orderCode,orderID:$scope.quickpayment.OrderDetail.UzaiOrder.OrderId,userId:userId,productId:$scope.quickpayment.OrderDetail.UzaiOrder.ProductId,productName:encodeURI($scope.quickpayment.OrderDetail.UzaiOrder.ProductName),productType:$scope.quickpayment.OrderDetail.UzaiOrder.ProductType,supplierFlag:$scope.quickpayment.OrderDetail.UzaiOrder.SupplierFlag,supplierNo:$scope.quickpayment.OrderDetail.UzaiOrder.SupplierNo,goDate:$scope.quickpayment.OrderDetail.UzaiOrder.GoDate,person:$scope.quickpayment.OrderDetail.UzaiOrder.Person,child:$scope.quickpayment.OrderDetail.UzaiOrder.Child,isUseCoupons:!1,isUsePoint:!1,PreferentialIds:PreferentialIds,preferentialTotalMoney:$scope.quickpayment.PreferentialMoney,enable:$scope.quickpayment.OrderDetail.UzaiOrder.Enable,state:$scope.quickpayment.OrderDetail.UzaiOrder.State});api.post($http,$scope,api.path.mbuylogic,"Payment","CheckPayOrderDetail",parameters,function(orderdata){if(hanlderResponse(orderdata)){var PayPlatForm=0;if(api.isApp()&&("ios"===devicetype?PayPlatForm=1:"android"===devicetype&&(PayPlatForm=2)),null===$scope.sendsmsInfo||"undefined"==typeof $scope.sendsmsInfo||""===$scope.sendsmsInfo)api.toast("验证码已失效,请重新获取验证码!",1500);else{ljpaybtn.classList.add("disable"),ljpaybtn.innerText="正在支付";var parameters=JSON.stringify({OutOrderCode:$scope.payordercodenum,AccNo:$doc.getElementsByClassName("cardnuminput")[0].value,SmsSendTime:$scope.sendsmsInfo.SmsSendTime,PhoneNo:$scope.paycardInfo.PhoneNo,PayAmount:$scope.orderPrepayMent,SmsCode:$doc.getElementsByClassName("yzminput")[0].value,PayPlatForm:PayPlatForm,UserId:userId,PayOrderCode:$scope.PayOrderCode});api.post($http,$scope,api.path.mpaylogic,"Payment","GetQuickUnionPay",parameters,function(paydata){if(api.loading(),null!==paydata&&"undefined"!=typeof paydata&&""!==paydata){if(-3===paydata.ErrorCode||-2===paydata.ErrorCode)return ljpaybtn.classList.remove("disable"),ljpaybtn.innerText="立即支付",-3===paydata.ErrorCode?api.toast("网络连接失败,请重试～"):api.toast(paydata.ErrorMsg),api.endloading(),!1;var parameters=JSON.stringify({OutOrderCode:$scope.payordercodenum,SmsSendTime:$scope.sendsmsInfo.SmsSendTime});setTimeout(function(){api.post($http,$scope,api.path.mpaylogic,"Payment","GetQueryPayOrderState",parameters,function(querydata){return api.loading(),hanlderResponse(querydata)?(api.toast("支付成功!",2e3),void setTimeout(function(){api.isApp()?orderCode.toLowerCase().indexOf("l")>-1?window.location.href="https://mhome.uzai.com/order/singleorderdetail.html?orderid="+$scope.quickpayment.OrderDetail.UzaiOrder.OrderId:bridge.openPayDetail($scope.quickpayment.OrderDetail.UzaiOrder.OrderId,1,isSonOrder):window.location.href="https://mpay.uzai.com/PayCallBack/QuickUnionPaySyncBack?code="+paydata.ErrorCode+"&msg="+paydata.ErrorMsg},2e3)):(ljpaybtn.classList.remove("disable"),ljpaybtn.innerText="立即支付",void api.endloading())},0,!1)},3e3)}else api.toast("支付异常!",2e3)},0,!1)}}},0,!1)}var $paycommon=new _paycommon.PayCommon($http,$scope);angular.element(document).ready(function(){api.router($http,$scope,$compile,"0")});var parameters=JSON.stringify({userid:userId,orderCode:orderCode,terminaltype:devicetype||"wap"});$paycommon.GetBankPreferentialList(parameters,function(paymentInfo){$scope.quickpayment=paymentInfo,$scope.orderPrepayMent=0,$scope.quickpayment.OrderDetail.UzaiOrder&&($scope.quickpayment.OrderDetail.UzaiOrderSonList&&$scope.quickpayment.OrderDetail.UzaiOrderSonList.length>0&&(isSonOrder=!0),$scope.orderPrepayMent=(1e3*$scope.quickpayment.OrderDetail.UzaiOrder.PrepayMent-1e3*$scope.quickpayment.PreferentialMoney)/1e3,$scope.payordercodenum="01"+$scope.quickpayment.OrderDetail.PayOrderID+"U"+orderCode+"U"+randomNum(5),$scope.PayOrderCode="01"+$scope.quickpayment.OrderDetail.PayOrderID,isSonOrder&&($scope.payordercodenum="02"+$scope.quickpayment.OrderDetail.PayOrderID+"U"+orderCode.replace("_","U")+"U"+randomNum(5),$scope.orderPrepayMent=1e3*$scope.quickpayment.OrderDetail.UzaiOrder.PrepayMent/1e3,$scope.PayOrderCode="02"+$scope.quickpayment.OrderDetail.PayOrderID),$scope.quickpayment.OrderDetail.OrderModifyPrices&&$scope.quickpayment.OrderDetail.OrderModifyPrices.length>0&&($scope.additionalExtras=$scope.quickpayment.OrderDetail.OrderModifyPrices.filter(function(modifyPrice){return modifyPrice.ModefyPirce>0}),$scope.preferentialExtras=$scope.quickpayment.OrderDetail.OrderModifyPrices.filter(function(modifyPrice){return modifyPrice.ModefyPirce<=0})))}),$scope.showOrderDetail=function(){var numbers={1:"一",2:"二",3:"三",4:"四",5:"五",6:"六",7:"七",8:"八",9:"九",10:"十",11:"十一",12:"十二",13:"十三",14:"十四",15:"十五",16:"十六",17:"十七",18:"十八",19:"十九",20:"二十"};$scope.quickpayment.OrderDetail.UzaiOrderSonList&&$scope.quickpayment.OrderDetail.UzaiOrderSonList.forEach(function(item,i){item.name="子订单"+numbers[i+1]});var _detHeight=.8*$(window).height();$scope.showDetailMask=!0,setTimeout(function(){$(".detailed-pop .scroll-box").css({"max-height":_detHeight-$(".detailed-pop .top").height()});var _top=($(window).height()-$(".detailed-pop").height()-$(".detailed-pop .close-btn").height())/2;$(".detailed-pop").css({top:_top,position:"fixed"}),$(".detailed-pop .close-btn").css({top:$(".detailed-pop").height()+1.3*_top}),$("body").css("overflow-y","hidden");var element_pop=document.getElementById("detailed-pop");element_pop.addEventListener("touchstart",function(){var startTopScroll=element_pop.scrollTop;0>=startTopScroll&&setTimeout(function(){element_pop.scrollTop=2},0),startTopScroll+element_pop.offsetHeight>=element_pop.scrollHeight&&setTimeout(function(){element_pop.scrollTop=element_pop.scrollHeight-element_pop.offsetHeight-2},0)})},100)};var $doc=document,getyzm=$doc.getElementsByClassName("getyzm")[0],getspan=$doc.getElementsByClassName("tsyzm")[0],ljpaybtn=$doc.getElementsByClassName("ljpaybtn")[0],yzminput=$doc.getElementsByClassName("yzminput")[0],cardnuminput=$doc.getElementsByClassName("cardnuminput")[0],Quick_payment={create:function(){var Quick_payment={init:function(){this.yzmfn(),this.pageonefn()},yzmfn:function(){getyzm.addEventListener("click",function(){if(0===cardnuminput.value.length)api.toast("银行卡号不能为空!",1500);else if(cardnuminput.value.length>15){getyzm.classList.add("hide"),getspan.classList.remove("hide"),getspan.innerText="正在发送中...";var parameters=JSON.stringify({OutOrderCode:$scope.payordercodenum,AccNo:cardnuminput.value});api.post($http,$scope,api.path.mpaylogic,"Payment","CheckQuickUnionPayCard",parameters,function(objcardinfo){if(200===objcardinfo.ErrorCode||-3===objcardinfo.ErrorCode){if(-3===objcardinfo.ErrorCode)getspan.classList.add("hide"),getyzm.classList.remove("hide"),api.toast("网络连接失败,请重试～",2e3);else if("00"===objcardinfo.ErrorMsg){$scope.paycardInfo=JSON.parse(objcardinfo.JsonResult),getyzm.classList.add("hide"),getspan.classList.remove("hide");var count=60;getspan.innerText="正在发送中...";var time=setInterval(function(){return 0==count?(getspan.classList.add("hide"),getyzm.classList.remove("hide"),getyzm.innerText="重新发验证码",count=60,void clearInterval(time)):(getspan.classList.remove("hide"),getyzm.classList.add("hide"),count--,getspan.innerText=count+"s后重新发送",void 0)},1e3),parameters=JSON.stringify({OutOrderCode:$scope.payordercodenum,AccNo:cardnuminput.value,SmsType:2,PhoneNo:$scope.paycardInfo.PhoneNo,PayAmount:$scope.orderPrepayMent});api.post($http,$scope,api.path.mpaylogic,"Payment","GetQuickUnionPaySendSms",parameters,function(datasms){hanlderResponse(datasms)&&($scope.sendsmsInfo=JSON.parse(datasms.JsonResult))},0,!1)}}else-2===objcardinfo.ErrorCode&&("77"===objcardinfo.ErrorMsg?$scope.showErrorOpen=!0:(getspan.classList.add("hide"),getyzm.classList.remove("hide"),api.toast(objcardinfo.ErrorMsg)))},0,!1)}else api.toast("请输入正确的银行卡号!",1500)},!1)},pageonefn:function(){cardnuminput.addEventListener("input",pagecardnumber,!1),yzminput.addEventListener("input",pagesmsnumber,!1)}},pagecardnumber=function(){if(cardnuminput.value.length>16){var v=cardnuminput.value.slice(0,19);cardnuminput.value=v}6===yzminput.value.length&&cardnuminput.value.length>15?ljpaybtn.classList.remove("disable"):ljpaybtn.classList.add("disable")},pagesmsnumber=function(){limitdatas("yzminput",6),6===yzminput.value.length&&cardnuminput.value.length>15?ljpaybtn.classList.remove("disable"):ljpaybtn.classList.add("disable")},limitdatas=function(classname,maxlen){var classname=$doc.getElementsByClassName(classname)[0];if(classname.value.length>maxlen){var v=classname.value.slice(0,maxlen);classname.value=v}},winHeight=$(window).height();return $(window).resize(function(){var thisHeight=$(this).height();winHeight-thisHeight>50?$("body").css("height",winHeight+"px"):$("body").css("height","100%")}),Quick_payment}},quickpayment=Quick_payment.create();quickpayment.init(),$scope.otherpay=function(){var url="https://mpay.uzai.com/pay/index.html?orderCode="+orderCode;orderCode.indexOf("l")>-1&&(url="https://mpay.uzai.com/pay/individual-payment.html?ordercode="+orderCode),window.location=url},$scope.quickopen=function(){$scope.showErrorOpen=!1;var parameters=JSON.stringify({OutOrderCode:$scope.payordercodenum,UserId:userId,OrderCode:orderCode,PreferentialIds:PreferentialIds});api.post($http,$scope,api.path.mpaylogic,"Payment","GetQuickUnionPayFrontOpen",parameters,function(openInfo){if(hanlderResponse(openInfo)){var MPayRes=JSON.parse(openInfo.JsonResult),div=document.createElement("div");""!==MPayRes.MPayRes&&"undefined"!=typeof MPayRes.MPayRes&&(div.innerHTML=MPayRes.MPayRes.replace(/&plus/g,"+"));var str=div.innerHTML;str=str.substring(0,27)+'target="hidden_iframe" '+str.substr(27),$(document.body).append(str)}},0,!1),$scope.showErrorOpen=!1,smsCodeType()},$scope.continuepay=function(){$scope.showErrorCardBin=!1,quickpay()},$scope.ljPay=function(){if(!ljpaybtn.classList.contains("disable")){var parameters=JSON.stringify({OrderId:$scope.quickpayment.OrderDetail.UzaiOrder.OrderId,OrderCode:$scope.quickpayment.OrderDetail.UzaiOrder.OrderCode,CardNumber:$doc.getElementsByClassName("cardnuminput")[0].value,PersonCount:$scope.quickpayment.OrderDetail.UzaiOrder.Person,ChildCount:$scope.quickpayment.OrderDetail.UzaiOrder.Child});api.post($http,$scope,api.path.mpaylogic,"Payment","GetCheckBankCardBin",parameters,function(cardbin){if(200===cardbin.ErrorCode)quickpay();else if(-2===cardbin.ErrorCode){var cb=JSON.parse(cardbin.ErrorMsg);cb.Flag?$scope.showErrorCardBin=!0:quickpay()}},0,!1)}},$scope.clickMask=function(){$scope.showDetailMask&&($scope.showDetailMask=!1),$scope.showErrorOpen&&($scope.showErrorOpen=!1,smsCodeType()),$scope.showErrorCardBin&&($scope.showErrorCardBin=!1),$scope.showCancelMask&&($scope.showCancelMask=!1),$("body").css("overflow-y","scroll")},$scope.goBack=function(){null!==$scope.sendsmsInfo&&"undefined"!=typeof $scope.sendsmsInfo&&""!==$scope.sendsmsInfo?$scope.showCancelMask=!0:$scope.backoperation()},$scope.backoperation=function(){if(""===api.getUser().userId||null===api.getUser().userId||"undefined"==typeof api.getUser().userId&&""!==api.getCookie("EncyQuickLink")&&null!==api.getCookie("EncyQuickLink")&&_typeof("undefined"!==api.getCookie("EncyQuickLink")))window.location.href=document.referrer;else{var _url="https://mpay.uzai.com/pay/index.html?orderCode="+orderCode;orderCode.indexOf("l")>-1&&(_url="https://mpay.uzai.com/pay/individual-payment.html?ordercode="+orderCode),bridge.goBack(_url,!0,!1,0)}},window.childrenFunction={childunionpay:function(){$scope.quickopen(),$(document).on("click",".openunionpayreset",function(){$("#hidden_iframe").html(" ")}),$(document).on("click",".j_ktpay",function(){$scope.quickopen()}),$("iframe").height(window.innerHeight-$(".white-topbar").height())}}}),uzai.filter("trustHtml",function($sce){return function(input){return $sce.trustAsHtml(input)}});for(var jinputnum=document.getElementsByClassName("j_input_num"),i=0;i<jinputnum.length;i++)jinputnum[i].onkeyup=function(){13===event.keyCode&&(event.keyCode=9)},jinputnum[i].onkeypress=function(){(event.keyCode<48||event.keyCode>57)&&(event.returnValue=!1)};window.androidGoBack=androidGoBack}(window,document,$,uzai)},function(module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),PayCommon=function(){function PayCommon($http,$scope){_classCallCheck(this,PayCommon),this.$http=$http,this.$scope=$scope,this.devicetype=api.getQueryString("devicetype")||"wap"}return _createClass(PayCommon,[{key:"is_weixin",value:function(){var ua=navigator.userAgent.toLowerCase();return ua.indexOf("micromessenger")>-1}},{key:"GetBankPreferentialList",value:function(parameters,callback){var _this=this,_that=this,controller="",actionname="";""!==api.getUser().userId&&null!==api.getUser().userId&&"undefined"!=typeof api.getUser().userId?(controller="Payment",actionname="GetBankPreferentialList"):(controller="QuickPayLink",actionname="GetQuickPayLinkInit"),api.post(this.$http,this.$scope,api.path.mpaylogic,controller,actionname,parameters,function(data){if(_that.hanlderResponse(data)){if(data=JSON.parse(data.JsonResult),"7"===data.OrderDetail.UzaiOrder.Enable||"7"!==data.OrderDetail.UzaiOrder.Enable&&data.IsSonOrderPay===!0)api.toast("该笔付款已完成，请登录后查看订单状态!",2e3),setTimeout(function(){location.href="https://u.uzai.com/mobile/order"},2e3);else if("9"===data.OrderDetail.UzaiOrder.Enable)return void api.toast("该订单已取消，如需支付请重新下单!");if(_this.$scope.isshowapplepay=!1,_this.$scope.isios=!1,api.isApp()){var appversion=api.getCookie("appversion");if("5.5.6">appversion){var notGiftCard=function(element,index,array){return 10!==element.BankID};data.Banks=data.Banks.filter(notGiftCard)}if("ios"===devicetype){_this.$scope.isios=!0,_this.$scope.isbindbankcard=api.getCookie("isbindbankcard");var phonetype=api.getCookie("phonetype"),systemversion=api.getCookie("systemversion");if(systemversion&&systemversion.split(".").length<3)for(var i=0;i<3-systemversion.split(".").length;i++)systemversion+=".0";if(appversion>="5.5.2"&&Number("9.2.0".replace(/\./g,""))<=Number(systemversion.replace(/\./g,""))&&("iphone6"===phonetype||"iphone6s"===phonetype||"iphone6plus"===phonetype||"iphone6splus"===phonetype||"iphone7"===phonetype||"iphone7plus"===phonetype||"iphonese"===phonetype||"ipad"===phonetype)&&(_this.$scope.isshowapplepay=!0),!_this.$scope.isshowapplepay){var notapplepay=function(element,index,array){return 84!==element.BankID};data.Banks=data.Banks.filter(notapplepay),data.IsBankPref&&(data.PreferentialMoney=0);var notapplepaypref=function(element,index,array){return 32!==element.PreferentialType};data.OrderDetail.UzaiPreferentialRecord=data.OrderDetail.UzaiPreferentialRecord.filter(notapplepaypref)}}}if(_this.is_weixin()){var notalipay=function(element,index,array){return 45!==element.BankID};data.Banks=data.Banks.filter(notalipay),data.IsBankPref&&(data.PreferentialMoney=0);var notalipaypref=function(element,index,array){return 32!==element.PreferentialType};data.OrderDetail.UzaiPreferentialRecord=data.OrderDetail.UzaiPreferentialRecord.filter(notalipaypref);var openidkey=data.WeiXinOpenIdKey;if(_this.$scope.openidvalue=api.getCookie(openidkey),null===_this.$scope.openidvalue||""===_this.$scope.openidvalue||"undefined"==typeof _this.$scope.openidvalue){var checkurl="https://m.uzai.com/WeiXin/Authorization?MyUrl="+encodeURIComponent(decodeURIComponent(location.href).replace("#rd&","&").replace("#rd",""));location.href="https://open.weixin.qq.com/connect/oauth2/authorize?appid="+data.MWeiXinAppId+"&redirect_uri="+encodeURIComponent(checkurl)+"&response_type=code&scope=snsapi_base&state=STATE#wechat_redirect"}}if(data.GetCustomTelList)for(var _i=0;_i<data.GetCustomTelList.length;_i++)1===data.GetCustomTelList[_i].Type?"ios"===devicetype&&(_this.$scope.Telphone=data.GetCustomTelList[_i].Telephone):2===data.GetCustomTelList[_i].Type?"android"===devicetype&&(_this.$scope.Telphone=data.GetCustomTelList[_i].Telephone):20===data.GetCustomTelList[_i].Type&&"ios"!==devicetype&&"android"!==devicetype&&(_this.$scope.Telphone=data.GetCustomTelList[_i].Telephone);callback(data)}},0,!1)}},{key:"mobilePay",value:function(orderCode,isSonOrder,tuanId,payOrderID,preferentialIds,preferentialTotalMoney,bankCode,userId){var bcmpayurl="https://mpay.uzai.com/pay/bcmpay.html?orderCode="+orderCode+"&orderId="+(isSonOrder?"02":"01")+payOrderID+"&tuanId="+(null===tuanId?0:tuanId)+"&preferentialIds="+preferentialIds+"&preferentialTotalMoney="+preferentialTotalMoney,flippedCardUrl="https://mpay.uzai.com/pay/flippedpay.html?orderCode="+orderCode+"&orderId="+this.$scope.paymentInfo.OrderDetail.UzaiOrder.OrderId,quickunionpayurl="https://mpay.uzai.com/pay/quickunionpay.html?orderCode="+orderCode+"&preferentialIds="+preferentialIds;if(api.isApp())if("BCM"===bankCode)window.location.href=bcmpayurl;else if("FlippedCard"===bankCode)window.location.href=flippedCardUrl;else if("QuickUnionPay"===bankCode)window.location.href=quickunionpayurl;else{var params={payType:bankCode,IsSSL:0,IsUtour:0,goDate:this.$scope.paymentInfo.OrderDetail.UzaiOrder.GoDate,nums:this.$scope.paymentInfo.OrderDetail.UzaiOrder.OrderPresonCount,orderCode:orderCode,orderId:payOrderID,pname:this.$scope.paymentInfo.OrderDetail.UzaiOrder.ProductName,prepayment:this.$scope.orderPrepayMent};bridge.invokeBankPay(params)}else{var param={OutOrderCode:payOrderID,UserId:userId,payType:bankCode,ClientIP:api.getCookie("spbill_create_ip")};switch(this.is_weixin()&&(param.OpenId=this.$scope.openidvalue),isSonOrder?param.OutOrderCode="02"+payOrderID:param.OutOrderCode="01"+payOrderID,param=JSON.stringify(param),bankCode){case"KQ":this.mpayRedirect("GetMKQPay",param);break;case"AliPay":this.mpayRedirect("GetMAliPay",param);break;case"MWeiXin":this.is_weixin()?this.mpayRedirect("GetMWeiXinPay",param):this.mpayRedirect("GetMArouseWinXinClientPay",param);break;case"BCM":window.location.href=bcmpayurl;break;case"QuickUnionPay":window.location.href=quickunionpayurl;break;case"FlippedCard":window.location.href=flippedCardUrl}}}},{key:"mpayRedirect",value:function(mpayaction,param){var _that=this;this.is_weixin()&&"MWeiXin"===JSON.parse(param).payType?api.post(this.$http,this.$scope,api.path.mpaylogic,"Payment",mpayaction,param,function(data){function onBridgeReady(){var payData=MPayRes;if(payData){var jsonData=payData;if("fail"===jsonData.return_code.toLowerCase())return void alert(jsonData.return_msg);if("fail"===jsonData.result_code.toLowerCase())return void alert(jsonData.err_code_des);window.WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:jsonData.appid,timeStamp:jsonData.timestamp,nonceStr:jsonData.nonce_str,"package":jsonData["package"],signType:jsonData.signType,paySign:jsonData.sign},function(res){"get_brand_wcpay_request:ok"===res.err_msg&&(api.toast("支付完成",1e3),location.href="https://u.uzai.com/mobile/order"),"get_brand_wcpay_request:cancel"===res.err_msg&&(api.toast("支付失败",1e3),location.href="https://u.uzai.com/mobile/order"),"get_brand_wcpay_request:fail"===res.err_msg&&(api.toast("支付失败",1e3),location.href="https://u.uzai.com/mobile/order")})}}if(api.loading(),_that.hanlderResponse(data)){var MPayRes=JSON.parse(data.JsonResult);"undefined"==typeof WeixinJSBridge?document.addEventListener?document.addEventListener("WeixinJSBridgeReady",onBridgeReady,!1):document.attachEvent&&(document.attachEvent("WeixinJSBridgeReady",onBridgeReady),document.attachEvent("onWeixinJSBridgeReady",onBridgeReady)):onBridgeReady()}},0,!1):this.is_weixin()||"MWeiXin"!==JSON.parse(param).payType?api.post(this.$http,this.$scope,api.path.mpaylogic,"Payment",mpayaction,param,function(data){if(api.loading(),_that.hanlderResponse(data)){var MPayRes=JSON.parse(data.JsonResult),div=document.createElement("div");""!==MPayRes.MPayRes&&"undefined"!=typeof MPayRes.MPayRes&&(div.innerHTML=MPayRes.MPayRes.replace(/&plus/g,"+")),document.body.appendChild(div),document.forms[0].submit()}},0,!1):api.post(this.$http,this.$scope,api.path.mpaylogic,"Payment",mpayaction,param,function(data){if(api.loading(),!_that.hanlderResponse(data))return void api.endloading();var weixinjson=JSON.parse(data.JsonResult);if("success"===weixinjson.ReturnCode.toLowerCase()&&"success"===weixinjson.ResultCode.toLowerCase()){var mweburl=weixinjson.MwebUrl;window.location.href=mweburl}},0,!1)}},{key:"hanlderResponse",value:function(response){var _that=this;return 200===response.ErrorCode?!0:-3===response.ErrorCode?(api.toast("网络连接失败,请重试～"),!1):(-5===response.ErrorCode&&(api.toast(response.ErrorMsg,2e3),this.$scope.showPreferentials=!1,_that.GetBankPreferentialList(parameters)),-6===response.ErrorCode?(this.$scope.showError=!0,!1):(api.toast(response.ErrorMsg,2e3),!1))}},{key:"gaStatistics",value:function(data,orderCode){setTimeout(function(){var travelClass={1:"出境游",2:"国内游",3:"周边游",4:"签证",5:"酒店",6:"国内机票",7:"门票",8:"租车",9:"手机租赁",10:"自驾游",11:"机票+酒店",12:"巴士+酒店",13:"国内半自助",14:"一日游",15:"海外自由行",16:"国内自由行",17:"邮轮船票",18:"邮轮套餐",19:"自驾车+酒店",20:"接送机",21:"国际酒店",22:"国内酒店",23:"房型",24:"团队游(国内)",25:"手机",26:"附加产品",27:"团队游(出境)",28:"会员",29:"周边自由行",32:"国际机票",33:"供应商确认单",34:"其他业务收入",35:"资深",37:"wifi租赁",38:"国内私家团产品",39:"单项服务",40:"出境私家团产品",41:"特卖会产品",42:"国际火车",43:"要出发",44:"奇迹旅行"};try{window.ga("require","ecommerce","ecommerce.js"),window.ga("ecommerce:addTransaction",{id:orderCode,affiliation:"",revenue:data.OrderDetail.UzaiOrder.PrepayMent,shipping:"",tax:""}),window.ga("ecommerce:addItem",{id:orderCode,name:data.OrderDetail.UzaiOrder.ProductName,sku:data.OrderDetail.UzaiOrder.ProductId,category:travelClass[data.OrderDetail.UzaiOrder.UzaiTravelClassID],price:data.OrderDetail.UzaiOrder.PrepayMent,quantity:data.OrderDetail.UzaiOrder.Person+data.OrderDetail.UzaiOrder.Child}),window.ga("ecommerce:send")}catch(err){}},200)}}]),PayCommon}();exports.PayCommon=PayCommon}]);