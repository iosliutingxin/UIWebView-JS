"use strict";!function(window){function androidGoBack(){window.history.go(-1)}function bindgoback(){var _orderCode=api.getQueryString("orderCode");null!==_orderCode&&"undefined"!==_orderCode&&""!==_orderCode&&void 0!==_orderCode&&"undefined"!=typeof _orderCode?window.location.href="https://mpay.uzai.com/pay/flippedpay.html?orderCode="+_orderCode:window.location.href="https://mhome.uzai.com/flippedcard/myflippedcard.html"}window.androidGoBack=androidGoBack,api.__asyncLoadingCode__="0";var $doc=document,$J_user_input=$doc.querySelector(".J_user"),$J_pass_input=$doc.querySelector(".J_pass"),$J_code_input=$doc.querySelector(".J_code");$J_user_input.onfocus=function(){this.parentElement.classList.add("input_error"),this.parentElement.querySelector("span").classList.remove("error"),this.parentElement.querySelector("span").innerHTML="请输入卡号"},$J_user_input.onblur=function(){0===this.value.length?this.parentElement.classList.remove("input_error"):this.value.length>30||!/^[A-Za-z0-9]+$/.test(this.value)?(this.parentElement.classList.add("input_error"),this.parentElement.querySelector("span").classList.add("error"),this.parentElement.querySelector("span").innerHTML="卡号仅可输入数字和字母，请重新输入"):this.parentElement.classList.remove("input_error")},$J_pass_input.onfocus=function(){this.parentElement.classList.add("input_error"),this.parentElement.querySelector("span").classList.remove("error"),this.parentElement.querySelector("span").innerHTML="请输入密码"},$J_pass_input.onblur=function(){0===this.value.length?this.parentElement.classList.remove("input_error"):this.value.length>20||!/^[A-Za-z0-9]+$/.test(this.value)?(this.parentElement.classList.add("input_error"),this.parentElement.querySelector("span").classList.add("error"),this.parentElement.querySelector("span").innerHTML="密码仅可输入数字和字母，请重新输入"):this.parentElement.classList.remove("input_error")};var $app=angular.module("bindApp",[]);$app.controller("bindController",function($scope,$http){function valildate(){return 0===$J_user_input.value.length?($J_user_input.parentElement.classList.remove("input_error"),$J_user_input.parentElement.querySelector("span").classList.remove("error"),$J_user_input.parentElement.querySelector("span").innerHTML="请输入卡号",$J_user_input.onfocus(),!1):$J_user_input.value.length>30||!/^[A-Za-z0-9]+$/.test($J_user_input.value)?($J_user_input.parentElement.classList.add("input_error"),$J_user_input.parentElement.querySelector("span").classList.add("error"),$J_user_input.parentElement.querySelector("span").innerHTML="卡号仅可输入数字和字母，请重新输入",!1):0===$J_pass_input.value.length?($J_pass_input.parentElement.classList.remove("input_error"),$J_pass_input.parentElement.querySelector("span").classList.remove("error"),$J_pass_input.parentElement.querySelector("span").innerHTML="请输入密码",$J_pass_input.onfocus(),!1):$J_pass_input.value.length>20||!/^[A-Za-z0-9]+$/.test($J_pass_input.value)?($J_pass_input.parentElement.classList.add("input_error"),$J_pass_input.parentElement.querySelector("span").classList.add("error"),$J_pass_input.parentElement.querySelector("span").innerHTML="密码仅可输入数字和字母，请重新输入",!1):0===$J_code_input.value.length?(api.toast("请输入验证码！","3000"),!1):!0}function bind(){var _param=JSON.stringify({UserId:_userId,CouponCode:$J_user_input.value,OriginalPwd:$J_pass_input.value});api.post($http,$scope,api.path.mpaylogic,"FlippedCard","Bind",_param,function(obj){if(200===obj.ErrorCode||-3===obj.ErrorCode){if(-3===obj.ErrorCode)api.toast(obj.ErrorMsg);else{var _result=JSON.parse(obj.JsonResult);1002===_result.Code?(api.toast("心动卡绑定成功！","5000"),setTimeout(function(){bindgoback()},3e3)):api.toast(_result.Message,"3000")}api.endloading()}else api.endloading(),api.toast(obj.ErrorMsg)},0,!1)}var _userId=api.getQueryString("userid");return _userId&&"undefined"!=typeof _userId||(_userId=api.getUser().userId,_userId&&"undefined"!=typeof _userId)?($doc.getElementById("imgCode").src="https://mhome.uzai.com/Member/GetFlippedCardCode?userId="+_userId+"&timer="+(new Date).getTime(),$scope.GetCode=function(){$doc.getElementById("imgCode").src="https://mhome.uzai.com/Member/GetFlippedCardCode?userId="+_userId+"&timer="+(new Date).getTime()},$scope.bind=function(){if(!valildate())return!1;var _param=JSON.stringify({userId:_userId,imageCode:$J_code_input.value});api.post($http,$scope,api.path.mpaylogic,"FlippedCard","ValidImgCode",_param,function(obj){if(200===obj.ErrorCode||-3===obj.ErrorCode){if(-3===obj.ErrorCode)return api.toast(obj.ErrorMsg),!1;bind(),api.endloading()}else $doc.getElementById("imgCode").src="https://mhome.uzai.com/Member/GetFlippedCardCode?userId="+_userId+"&timer="+(new Date).getTime(),api.endloading(),api.toast(obj.ErrorMsg)},0,!1)},void($scope.goback=function(){var _orderCode=api.getQueryString("orderCode");null!==_orderCode&&"undefined"!==_orderCode&&""!==_orderCode&&void 0!==_orderCode&&"undefined"!=typeof _orderCode?window.location.href="https://mpay.uzai.com/pay/flippedpay.html?orderCode="+_orderCode:window.location.href="https://mhome.uzai.com/flippedcard/myflippedcard.html"})):void api.login(window.location.href,window.location.href)})}(window);